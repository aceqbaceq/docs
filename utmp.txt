| utmp
| wtmp


пока кратко. 
есть файлы

  $ ls -1al /var/log/wtmp 
-rw-rw-r-- 1 root utmp 174336 дек  1 14:03 /var/log/wtmp

  $ ls -1al /var/run/utmp 
-rw-rw-r-- 1 root utmp 42240 дек  1 14:03 /var/run/utmp


один из них получается выжиывает при перезагружке а второй нет.
оба они используются программами для того чтлюы фиксировать что какйото юзер покдлючился\вошел
в систему. 
важно отменить что запись в этим файлы идет не по иницииации ядра . нет. запись в этим
файлы иниициируют сами программы. это рекомендванная вещь. и программа необбязана делать
туда записи. 
именно из этих файлов читает команда

		$ who

так вот так как делать записи неоязателно то получется то что полказвает who это неточная
тинформация. тоесть часть реальных событий просто будет отсуттовать.! это важно понмиать


что значит на практике юзер покдлюлся к системе?
значит у нас в систсеме появился процесс который непрстотак болтается а  он подклчен к файлу
терминала. тоесть у процесса у этого открыт либо файл

		/dev/pts/N

либоо откытьь файл 

		/dev/ttyN

а раз полявился такой пройцесс новйы то это значит что через этот файл терминала снаружи
от системы сидит юзер и пихает данные в этот процесс а процесс обратно пихает тоже какието
данные. тоест получется некий юзер снаружи "общается" с процессом. а это уже непорядок. 
это бы надо зафиксировать. 
поскольку проецсс сам по себе из воздуха не поялвется а обычно он появется путем того что
какйото парент процесс себя клониурет. то тот процесс-А (который создает наш конечнй процесс-Б
который будет покдлючен к файлу терминала ) по хорошему доожен сделать записи об этом событии
в utmp и wtmp файлы! прикол я говорю в том что это только рекомедайия и деалеко не все процессы
это делают. намриер xterm это делает. а например gnome-terminal хуй поймешь. скорей всего
когда gnome-terminal открывает первое окно черное то он это делает. а когда мы потом открываем
доп окна черные то он уже этого неделает.

поскольку это все рекомендателная вещь инфорацяи из этих файлв отчасти полезная а отчатсти фуфло
потому что там получается невсе  "логины" юзеров будут записаны

вот как это можно поймать у xtermm

  $ strace -f -e clone,execve xterm
execve("/usr/bin/xterm", ["xterm"], 0x7fff3ba62d88 /* 66 vars */) = 0

clone(child_stack=NULL, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLDstrace: Process 2902410 attached
, child_tidptr=0x78751be81a50) = 2902410

[pid 2902410] execve("/usr/lib/utempter/utempter", ["/usr/lib/utempter/utempter", "add", ":0"], 0x629ce0f242f0 /* 67 vars */) = 0


по факту ксатти при старте xterm там дохерена делает clone() запускаю кучу вспомогатеьных 
хреней который делают свое дело и сами себя грохают. тоест это нетлоько /usr/lib/utempter/utempter
ну а прога
  
  	/usr/lib/utempter/utempter

это именно та прога которая умеет дедат записи в utmp wtmp

как в итоге псмотреть список по времени этих событйи. две уитилиыт на вскидку who и last

  $ last | head -n3
noroot   tty2                          Sun Dec  1 14:03 - 14:03  (00:00)
noroot   pts/133      :0               Sun Dec  1 13:55 - 13:55  (00:00)
noroot   pts/133      :0               Sun Dec  1 13:53 - 13:53  (00:00)

 
 $ who -a | tail -n5
noroot   + pts/118      2024-11-29 21:12  old      2849101
noroot   + pts/120      2024-11-29 21:20  old      2849499
           pts/122      2024-12-01 14:03           2898465 id=/122  term=0 exit=0
           pts/131      2024-12-01 13:46           2895268 id=/131  term=0 exit=0
           pts/133      2024-12-01 13:55           2897207 id=/133  term=0 exit=0

причем их вывод отличется. почему нестал разбиарться. 
и в чем деилизм что одна печает сверху вниз по времени а вторая наоброт сниху вверх
по вермени

вот видно что согдано одной утилиие последний "вход" был в 13:55 а согласно второц он был в 14:03
поэтому надо смотреть обе вывод с обох утилит

в цеом они показвыают КТО и КОГДА входил выходил. если мы хотим узнать про щас. то 
это можно сделать и руками просто нужно прогрепить полный список прцоессов у которых есть
либо ttyN либо dev/pts/N файл открытый и посмтреть под каким юзером рабоатет этот процесс


а вот я покажу как меняется выводу 

    $ who -a

кода я запускаю xtern и потом его закрываю

вот это вывод до запуска xterm
  $ who -a
           pts/131      2024-12-01 13:46           2895268 id=/131  term=0 exit=0
           pts/133      2024-12-01 13:53           2896887 id=/133  term=0 exit=0

вот я запустил xterm
  $ who -a
           pts/131      2024-12-01 13:46           2895268 id=/131  term=0 exit=0
noroot   + pts/133      2024-12-01 13:55   .       2897207 (:0)

вот я закрыл xterm
  $ who -a
           pts/131      2024-12-01 13:46           2895268 id=/131  term=0 exit=0
           pts/133      2024-12-01 13:55           2897207 id=/133  term=0 exit=0

забавно.




вообще эту тему я толкько начал смотреть но небыол сил поэтмоу ниже то что
было не проработано

who -a
man utmp
last(1)
login(1),  
logname(1), 
lslogins(1), 
users(1), 
utmpdump(1), 
who(1), 
login(3), 
logout(3),
logwtmp(3), 
updwtmp(3)
