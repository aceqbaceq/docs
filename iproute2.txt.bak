iproute2


никаких ip link set dev ens160 down
а только ifup ens160
ifdown ens160

s$ cat /etc/iproute2/rt_tables
#
# reserved values
#
255     local
254     main
253     default
0       unspec
#
# local
#
#1      inr.ruhep
200 net192_168_1_0
201 net192_168_0_0
203 net192_168_7_0



$ cat /etc/network/interfaces

k-kub2-06:~#
root@mk-kub2-06:~# cat /etc/network/interfaces
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

source /etc/network/interfaces.d/*

# The loopback network interface
auto lo
iface lo inet loopback

# The primary network interface



auto ens160

iface ens160 inet static
        address 192.168.1.56
        netmask 255.255.255.0
        gateway 192.168.1.1

        dns-nameservers 192.168.1.1
        dns-search m9.local


         post-up ip route add   192.168.1.0/24 dev ens160  table T1
         post-up ip route add  default   via 192.168.1.1  dev ens160 table T1
         post-up ip rule add from 192.168.1.0/24 table T1

         post-down ip rule del from 192.168.1.0/24 table T1


auto ens192

iface ens192 inet static
        address 192.168.7.243
        netmask 255.255.255.0


        post-up ip route add   192.168.7.0/24 dev ens192      table T7
        post-up ip route add  default   via 192.168.7.1  dev ens192    table T7
        post-up ip rule add from 192.168.7.0/24 table T7

        post-down ip rule del from 192.168.7.0/24 table T7



iface ens192 inet static
        address 192.168.0.243
        netmask 255.255.255.0


        post-up ip route add   192.168.0.0/24 dev ens192  table T0
        post-up ip route add  default   via 192.168.0.1  dev ens192  table T0
        post-up ip rule add from 192.168.0.0/24 table T0


        post-down ip rule del from 192.168.0.0/24 table T0








также упомянть что src в маршуртах играет рояль для пакетов которые рождаются на самом компе и нужно понять какой srcip им подставить.
а для пакетов ответ он неиспользуется. таким образом если на компе скажем несколько ip из одной сети 192.168.0.243 и 192.168.0.30 то ненадо 
бояться что записи в маршрутах src 192.168.0.243 будут перебивать 192.168.0.30 это нетак.

далее вызла проблема я. то указал 
	ip rule add from 192.168.1.0/24
то есть для всей подсети. и тошгда почему то на подах (они то тут причем) переестали на дата ноде liveness пинги проходить

а когда я сузил правило до ip rule add from 192.168.1.56
то на подах нормализовалось

что за фигня*?!?!?

обычная таблица маршрутизации она позволяет управлять в какую сетевую карту пихать пакет на основе его dst ip. 
при этом мы вобще неучитваем его src ip.

iprpute2 через ip rule позволяет маршуртиизровать также учитывая src ip
идетв связке с нескольмии dst таблицами маршрутизации

вообще таблицы марщрутизации можно всегда назвать dst ip таблицы маррутизауии

 в итоге пришось дополнительно написать службу systemd котораф встатлвяет маршруты
 
 ( см. "systemd сервис для iproute cni0.txt" )
