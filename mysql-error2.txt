| mysql



Ошибка
"Bad magic header in tc log" означает, что файл журнала координатора транзакций (tc.log) поврежден, обычно из-за внезапного отключения питания или нехватки места на диске. 
Чтобы восстановить работу MariaDB в 2026 году, следуйте этой инструкции:
1. Подготовка и очистка
Сначала необходимо переместить или удалить поврежденный файл. Важно: удаление этого файла может привести к потере данных в незавершенных распределенных (XA) транзакциях. 

    Остановите сервис (если он пытается запуститься):
    sudo systemctl stop mariadb
    Сделайте резервную копию файла (на всякий случай):
    sudo cp /var/lib/mysql/tc.log /var/lib/mysql/tc.log.bak
    Удалите поврежденный файл:
    sudo rm /var/lib/mysql/tc.log 

2. Запуск с эвристическим восстановлением
Теперь нужно запустить сервер вручную один раз, чтобы он обработал «зависшие» транзакции, о которых он больше не может прочитать в tc.log.
Выполните команду от имени пользователя mysql:
bash

sudo -u mysql mysqld --tc-heuristic-recover=ROLLBACK

Используйте код с осторожностью.

    ROLLBACK: отменит все незавершенные транзакции (рекомендуется для сохранения целостности).
    COMMIT: попытается зафиксировать их (используйте, если данные критически важны и вы готовы к возможным несоответствиям). 

Сервер выполнит восстановление и, скорее всего, сразу завершит работу (aborting) после очистки — это нормально. 