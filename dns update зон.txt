| dns
| update
| zones
| view


алгоритм обновления днс зон.


заходим на автортиииный сервер. смотрим есть ли зоны
заходдим в зону.

смотрим 

  ps -ef | grep named
  
и смотрим путь к кофнгу  у named внутои зоны.
потом выходим в глоаальную зону и делаем экспорт зоны чтобы увиедт  в каой пакепке лежит
корень зоны

напрмиер

# zonecfg -z dns-pri  export
create -b
set zonepath=/zone/dns-pri


теперь мы знаем где из глоадльной зоны смотреть файлы зоны.
еще засада может быть в том что в путях есь симлкинки поэтому это надо четко тоже отследить. 
хзаходим в 

		named.conf 

где бы он там ни лежал.
и там ищем view .
в секциях view указано в какиех файлах лежит зоны для которые этот сервер мастер.(это прямые зоны и обратыне зоны)
где лежат зоны для которых этот срвер слейв.

например там написано 


view    "internal" {
	...
	...
include "/etc/named/common.junk";
include "/etc/named/master.forward.zones";
include "/etc/named/slave.forward.zones";


заходим вэти файлы а там будет указано в каком конетеном файле находистя тело уже конеттной зоны.


zone "cat.vasya.ru"       {       type master;    file "fwd/m/public/cat.vasya.ru";};
zone "alt.petya.ru"       {       type master;    file "fwd/m/public/alt.petya.ru";};


иидем туда и вносим правку например дабялеим A запись
и также важно иземнеит увиелчиить параметр serial для SOA. 
обычно соа сериал менябт на базе правила что YYYYMMDDNN


теперь надо провверить что мы все сделаи коерктно 
проверяяем синксткиси наших имзениенений

 #  named-checkzone vasya.ru  fwd/m/public/cat.vasya.ru

тоеть укзываем имя зоны и файл зоны.
здесь может вылезти хуйня с ошибкой десь нужно просто посмотреть из какой папки зпапускать эту комнанду.
как правили нужно чтобы теукщая папка была та где лежит файл named.conf

далее елсли мы сделали имзенемя толко в последнем указанно файле 
то далее чтобы уже named засосал эти новые изменннения в зоне то достатчно 

 #  rndc reload  cat.vasya.ru  IN internal

где internal это имя view . это обязателно нужно указать если у нас кофниге есть вьющки.

если же мы делаои имзеемнеения еще и в файлайх вышележащих типа 

include "/etc/named/slave.forward.zones";

то тогда последняя командма не прокатит
и будет вот такая ошибка

   rndc: 'reload' failed: not found

и тогда нужно делать

  # rndc reconfig

а уже после него делать 

 #  rndc reload  cat.vasya.ru      IN internal



также меняются и обратные зоны с PTR записями.

  # named-checkzone 12.253.10.IN-ADDR.ARPA rev/m/office/10.253.12
  # rndc reload  12.253.10.IN-ADDR.ARPA  IN office


на счет проверкоок вот так провяеряем записи 
	    типа А
    $ dig -t A @10.253.253.10  truenas2.vasya.ru +short
    10.10.12.50



аналогично еще во такое поезено
	тип NS
    $ dig -t NS @10.253.253.10  truenas2.vasya.ru +short


	тип SOA
    $ dig -t SOA @10.253.253.10  truenas2.vasya.ru +short


а вот как 
	PTR записи 
запрашивать короткая форма
   

    $ dig -x  @10.253.253.10   10.10.12.50  +short
   truenas2.vasya.ru
  
но это форма она убивает мозг и она не всегда дает резульаттат
на смомом деел вот полная номральная форма которая неазатупляет мозг и она рабоатет всегда 


    $ dig -t PTR  @10.253.4.10     50.12.10.10.IN-ADDR.ARPA  +short
   truenas2.vasya.ru



про зону типы SLAVE
вот ее ее выглядит секция

zone "bil2.vasya.ru"      {type slave;     masters { 10.111.111.100; 10.111.111.200; }; file "internal/bil2.vasya.ru"; };


здест чожно заметть что появились вышележжащие сервера  с которых можно сказать  эту зону
и сам файл который указан нам создавать ненадо. его создаст сам неймд.
но мы прежде чем создаввать слейв зону может првеоирерить отдаст ли вышележащий сервер нам эту зону или неи


    # dig -b IP1        @10.111.111.100     bil2.vasya.ru       AXFR  > /home/named/tmp/log.txt
    
    
где IP1 это ип с которого наш днс сервер должен слать реквест на удаленный 10.111.111.100
и в логах убдет видно нам отдаи зону и ли нахер послали



а вот еще пример слейв зоны

zone "bil2.vasya.ru" {
    type slave;
    masterfile-format text;   /* Makes the saved file human-readable */
    file "fwd/s/internal/bil2.vasya.ru";
    masters { 10.111.11.100; 10.111.11.200; };
};


