| LUKS

LUKS+USB  в итоге отваливается

bad blocks -c 10240 -s -w -t random -v /dev/sdaX  - проверка на бедблоки

manjaro live usb имеет пароль manjaro



далее. почему посое установки манжаро у нас активно два кей слота?
оказывается есть такая фишка.чтобы не вводить пароль два раза то каждая 
партиция LUKS имеет два кей слота. Один слот имеет доступ по паролю с клавы.
Он задается для GRUB. тоест чтобы граб мог получить доступ к разделу
где лежит ядро. и он смог бы этот раздел расшфировать. прочитать ядро и засунуть
его в оперативку. и запустить его. но когда далее ядро запущено то оно не
знает пароол от раздела. и этот пароль нужно заново как то вводить. точнее
его надо вводить при работе initrd. второй слот уже както посзволяет раскодровать 
раздел на основе файла-ключа. тоесть можно предьявить файл-ключ. и он служит 
паролем. этот файл-ключ интегиррируется в initrd . и таким макаром процессы
в инирд получают доступ к шифро раздеду. я это убираю. убираю второй слот. 
чобы можно было получить оступ к разделу только по парол. да при загрузке
для каждого раздела нужно ввести два раза пароль. да и хуй с ним. 
проверка

  # cryptsetup  -v  --test-passphrase --key-file /tmp/file.txt open  /dev/sda1

ага. раздел открылся.

теерпт удаляем это все нахуй.

  # cryptsetup  luks remove  /dev/sda1 --key-file /tmp/file1.txt

проверяем что уже файл-ключ несрабатыает.

   # cryptsetup luksDump /dev/sda1  | grep "KeySlot"

в initramfs лежит файл crypto_keyfile.bin это и есть походу файл ключ

далее
установка манжаро через calamares дает только LUKSv1 а нужен LUKSv2 
у которого более высокая устойчивость к провреждению заголовка.

