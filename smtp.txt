есть такая тема 
как отправка\прием почты

тема мудацкая. но будем разговаривать.

как работает отправка почты.
вот мы хотим отправить почту на vasya@kuku.ru
тогда мы делаем запрос в интернет к DNS серверу 
такого вида

типа записи = MX 
домен = kuku.ru

в ответ мы получаем список серверов и их приоритет.
эти сервера это те сервера которые обслуживают примем почты для домена
kuku.ru

теперь мы стучим на  сервера из списка и пытаемся им спихнуть
почту для vasya@kuku.ru


как работает прием почты.
есть несколько разных способов как защититься от приема спама.


защита по PTR
	вот к нам стучится почтовый сервер 
		и говорит что его DNS имя = smtp.kuku.ru 
		это недостоверная информация ее нужно проверять.
		при этом мы видим что его IP=2.2.2.2
		это достверная информация мы ее знаем наверняка
	тогда мы делаем PTR запрос к DNS и спрашиваем скажи как нам
	дружок а какое DNS имя у ip=2.2.2.2
	если в ответ мы получаем что для ip=2.2.2.2 днс имя = smtp.kuku.ru
	то мы типа удостовериваемся что smtp сервер неврет.
	если же мы получаем в ответ от dns сервера ответ что для ip=2.2.2.2
	доменное имя хрен с горы то мы полагаем что smtp серверв врет и выдает себя за другого и что он спаи сервер и мы его шлем подальше
	
чтобы наш smtp сервер насчитали спамовым нужно обратится к тому кто владеет IP адресом = 2.2.2.2 это соотсвственно хостер\провайдер у которого физически размещается наш smtp сервер. и попросить его внести 
на его DNS сервере в reverse zone запись PTR которая резолвит ip=2.2.2.2 в доменное имя = smtp.kuku.ru


SPF защита

мы отправляем почту и в строке sender \mail from или чтото типа того 
мы заявляем что отправляем почту от имени vasya@kuku.ru то есть мы заялвяем что мы шлем почту от имени домена kuku.ru 
так вот мы можем защититься чтобы пиьсма для нашего домена kuku.ru имели право слать только определенные ip сервера. для этого мы идем на DNS сервер который держит зону kuku.ru и делаем на нем запись TXT 
вот такого вида

название = kuku.ru 
тип = TXT 
тело = v=spf1 ip4:2.2.2.2 ~all 


подоробности синтаксиса spf записи еще предстоит описать.
пока такое: когда сервер котоый принимает почту от нас получает от нас письмо то в нем видит что письмо якобы от домена kuku.ru , он делает 
запрос к нашему DNS серверу и ищет spf запись (замечу что ее тип не spf а txt) и читает там с какого ip сервера мы разрешили принимать почту от имени нашего домена. тогда принимающий сервер сверяет 2.2.2.2 равен ли  ip адресу почтового сервера который стучится к нему. 

продолжение следует...

