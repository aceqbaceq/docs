hyper-v

---

про  его сетевую часть
есть три типа вирт свича.

1. external switch
как это работает - мы захоим в панель управления HYPER-V и там тыкаем на менеджер
виртуальных свичей и там нажимаем создать новый external switch,
далее важно выбираем сет карту к которой прикрепится это  вирт сет свич.
тоесть выбранная нами железная сет карта будет аплинком для вирт свича.
также ставим важную галочку "allow management operating system to share this network adapter".
нажимаем окей. и после этого на этой сет карте будут обнулены все настройки. все ip адреса
итд. и останутся забинденными на этой карте такие сервисы как:
LLDP
HYPER-V switch

и виндовс создаст +1 вирт сет карту на которую как раз он автоматом и перенесет сет настройки 
с исходной карты (ip адрес \ сеть итд) , прям все все все настройки будут перенесены с той
исходной карты на эту виртуальную. 

после создания такого свича сеть выглядит так :  наши vNIC с виртуалок входят в вирт свич а далее
этот свич биндится на железную сетевую карту а оттуда оно идет уже во внешний мир.
значит ровно также как это есть у вмвейр свича наша биндинг карта она работает в режиме L2.
что интересно как я понял связь между виртуалками на этом свиче работает только за счет внешнего
железного свича. тоесть все проходит через внешний свич даже если мы с одной нашей виртуалки 
будем стучать на другую. это прикол.

а как же наша ОС? как она работает? а она работает по тойже схеме. она работает так как бутто наша ос
это тоже виртуалка ибо ОС создаст как  я уже сказал вирт карточку L3 впишет в нее все данные что 
были на исходной карточке и с этой карты будет пулять пакеты на биндинг карту. таким образом
наша хостовая ос как бы тоже стала как виртуалка с точки зрения сети.


из этого еще вытекает свойствао о том что каждая вм которая подключена к этому свичу должна иметь 
свой IP адрес собственный. IP нашей ОС к этим виртуалкам неимеет никакого отношения.

рисую схему

<внешний жел свич> ----- <железаня карта без IP,L2 режим>  --- <vnic L3 вирталки>
                                                          |---<вирт карта нашей ос>

также по поводу того как важно поставить галочку "allow management operating system to share this network adapter". ответ очень важно. если ее не поставить то +1 вирт карта виндовс автоматом не создаст
и IP который был на железной карте туда не перенесет и мы нахрен просто потеряем связь с нашим виндовсом.
ибо IP просто исчезнет. ибо как я уже сказал железная карта которая аплинк она переклчается в режим L2
на ней вобще больше никаких IP небудет. а перееносится он на вирт карту в сетевых настройках но только 
при условии выставлении галочки!

следущий тип свича это "internal switch".
с ним уже нет проблем что мы потреяе связь с хостом. когда его создаешь то он создает вирт карту
в сет настройках. и все вм которые входят в состав этого свича могут иметь с этой вирт картой связь.
поэтому через этот свич можно иметь связь между хостом и виртуалками по как бы внутренней между хостом
и виртуалками сети.

следущий тип свича это "private свич".
при его создании никких вирт карт не создатеся на хосте поэтому вирталки которые входят 
вовстав этого свича друг с другом могут общаться но ни с хостом ни с внешним миром связи у них нет.


есть еще один тип свича но его надо ставить руками через power shell это NAtswitch.
о нем ищи отдельно в инете.
---------- 




установка ubuntu22 на HYPER-V

ставим на вид виртуалки Gen2. 
инсталлер крашится если выбрать  кастомную разбивку диска и в ней LVM+xfs
выход: ставим как есть с автоматической разбивкой диска (LVM+ext4).
 а потом уже на работающей системе делаем перенос на LVM+xfs

либо ставим на кастомную разбивку xfs но без LVM.

при динамическом расширении диска из менеджера hyper-v потом это увеличение диска
можно будет увидеть в гостевой ос.
---
