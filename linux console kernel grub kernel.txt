| linux 
| console
| ядро
| kernel


что такое консоль в ядре линукса. 
как я понял это никакой не терминал. это вобще разные вещи.

вначал полезо порчиать dmesg.txt в моих файлах.
там частично верно раскрыто. а чтисно не раскрыто.
тут продождение


консоль в ядре линукса это вот что.
в ядре есть функция printk()
в ней указывается важнос мессаги и  сама мессага.
и это все запывается в память ядра назвыается какйото там RING
когда он пероплняется то запись начинася опмять с начала.

так вот printk() он пишет как раз таки в эту память.
юзер приложения могут из нее читать чрез /dev/kmsg
типа того.

но это еще не все.
в ядре есть перменная 

kernel.printk = 1 4 1 7

в ней первое число в данном случае 1 указыает вот что.  вот мы вызывали printk()
тогда мессага была задписана в RING памяти. а потом идет сравнение срочности указанной
в принтк и в kernel.printk = 1 и если мессага ткаяже или более срочная (чем меьеше число
тем более срочно и важно)то тогда на следюущем шаге эта месага ядром отправляется в
так назывваемую КОНСОЛЬ. а что же это такое.
когда дравйвер регистриутется в ядре то он типа обьявляет что в нем есть кусок есть 
функция котоаря отвечает требованияем консоли. это фунция .write()
и у нее есть фиксиорванные поля которые ядро требует чтобы они были.
ядру при старте юзер передает свой выбор какой драйвер использовать для коонсоли
   
    console=ttyS0


и ттгда ядро выбирает что драйвер ttyS0 и будет использовать фунцию косоли в этом драйрврее
для консоль.  по свой сути консоль это всего навсего хрень котоаря пзволяет ядру печатать
свои логи. это устройство ВЫВОДА. выводв и только вывода. с ввоодом консоль неимет
никкого отношения сука.тоесть косол ядра это железное йустойство вывода логов ядра. вот что 
такое косоль. поэтому никакой клавы не пдрузмуевается и в поминне.

в чем пиздец это коносли этой функции. одбычная фнция в ядре рабоатет так. она пихает даныне
в жедезку и засывапает. тоесть свобождает ядро. и просыпается обратно когда прилетет от 
железки irq. но для фнуцкции консоли сдеали по дргому. дело в том что косоль должна успешно
отрабать в случае кернел паника. чтоыбы на экране напечатат вот этот бесполезный мусор.
а дело в том что во время кернел панкиа ядро отключает перрываения. чтобы никкой хендрр
прерываний болше ничего не смоге сделать. а раз нераюооают праркрывания то обычная фунция
записи в железо небудет раать. так вот  фнуцию записи коносли написали так что она не юзает
прерыания она тупо отправляет текст в железку и при этом тупо врщаается в цикле опрашивая
жедлазку готова ли она приять очередную порциб текста. и прблема в том что вэтот момент
данный цпу он непринимате прерывания. больше нихера не делает. тоесть запист в консольэто
же обычно меделнаня оерция. железка меделнная. поэтому цпу наматывает огромные циклы 
делая мало что полезного. это имеетя ввиду тога когда в обычной жизни. кода нет кернел панкиаа.
такова плаата за то чтобы когда убдет кренел паник чтобы эта функция успешно могда 
отрабтаь при выдкченныех пррерываиняих. 

это значит что выгодно  вэтой перменной

kernel.printk = 1 4 1 7


выгодно понижать цифру. тоесть чтобы в консольрную железку ядро пихало сообщения пореже.
чтобы цпу ядро не гоняло воздух впустую. это несрагшно потому что все остальные мессаги
они ядром кладуюся в RING памяти и оттуа все можно читать в асинхронном реиме. тоест 
очень выгодня для цпу.



терминал при этом это своерешнно дургое.
рантше это была реальная железка. щас это виртлуаьная хрент внури ядра котоаря 
соединена через дарйверы с клавой и видоекратой. и эта хрень прдааназнченна для конатаката 
с юзером.  прикол в том что консоль ядра  тоже может использовать этот же драйвер 
для свох целеей. но это вещь втоиичаная.


 консоль ядра ----> tty1 ----драйвер монитора --- монитор(железка)
                         ----драйвер клавы --- клава(железка)
                         



я хочу сказать что tty1 драйвер это хрень котоаря связывает юзера за монитором и клавой 
с ядром.  а консоль ядра это некоторый драйвер который вддете на желекхку необязателно
это терминал которая умеет выводить информациб во вненний мир. нарпиме это может быть 
принтер матричный. поэтому терминал это лишь одно из возможных железных утрйств которые
ядро может использовать как свою косоль. свою петчалку своих логов. 
поэтмоу коснль яра и термиал это неодно и тоже сука.

пока хватит.пиздец
мудтоа



возвращаюсь к этой хкуйне


    console=ttyS0


к пармтеру граба кода он запуккает ядро
еще раз мыуказываем ядру в каокй драйвер ядро будет пихать свой аутпут свои логи (когда в ядре
запускется printk()) . еще рзаз подернку что драйвер может быть нелюбой. он должен поддержиываеть
осообоого рода фунцию которая спциально преднанначена для того чтобы ядро туда пихало свои
мессаги. так вот можно укзаать сразу неоклько устйрства. тоест

   console=tty2, console=ttyS0, console=ttyUSB0

больше деталей в этой шняге https://docs.kernel.org/admin-guide/serial-console.html
но важно то что эти логи ядро может печатать сразу на енесколько устрйсвтв.
тоесть на ком порт, на юсб порт, на вирульный терминал. еще раз почеркну что 
ни о какой обратной связи типа примема данных с клавы и речи неидет! это простканал 
печатания ядерных важных логов. 
но там сказано что также создается спец файл /dev/console
которай приззыется только к ОДНОМУ драйеверу указанному в строке . например к 
ttyS0.
как узнать к чему приязано /dev/console нужно ввести 

# cat /sys/class/tty/console/active
tty0



tty0 
это такая хрень она значает что тот tty терминал который щас активен. 
а как его узнать ? а вот как

# cat /sys/class/tty/tty0/active
tty7


таким макаром щас /dev/console на самом деле смотрит в tty7

а что это нам дает. ядро то вобще нахуй неисползует этот /dev/console
это вот что 
если наша юзер прогармма тоже хочеь погадить свои логи тудаже куда гадит ядро.
точнее ядро то может гадить нам ного утсрйство. а через /dev/console юзер 
прогамма может начать гаить на одно из этих утросйтво. вот тода мы оатраываем
/dev/console и туда начинаем гадить.

вобщем тихий ужас.
мдудота на пустом месте.


тут еще важен такой моент. мы выставляем в грабе пааметр ядра 
для косоли линукса 


    console=ttyS0


а и по хорошему на этот ком порт должн лететь только логи ядра!
но сука проиходит дополниельно вот чтою . в линукс есть службы котоыре
слелдят какие парамтры быыли переданы ядру. 
и они виядт что на ttyS0 будут лететь логи ядра. и тода эта служба ярдра она сука
вешает getty на этот же ttyS0!!!! и поэтому на этм ttyS0 помимо сранвы логов ядра также 
за счет гетти можно с клавы послать буквы. в этот гетти. вветси пароль а гетти обртано
на этот ttyS0 отшлет нам ответ. тоесть мы получаем рабочий теоминал.
и воникает чудочввтщная набека в голове что яокобы косгль ядра это терминал через который
мы делаем логин и входим в ситему и поадаем вбаш .  АЭЭТОНИХУЯ НЕ ТАК. 
консоль ядра это совереннро друная хуня. никак не связанная в общем плане с терминалогом
логином багшем.  вот имено изза того что в линуксе есть такаяхитрая служба она 
порждает такую меганаебку и смешенеи что якбоы косоль ядра это такокй канал 
через котоырй мойжно войти вистеме! это нуя нетак!! 
косоль ялра эторосто железка ерез которую ядро печатает свои логи и все блядь болше ничего.
просто окхзвыается ничего енмешает на эту жудеелзку еще присобаичитть гетти. и войти в висеме.
но это соерернно дргуая хуня!!

