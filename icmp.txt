ICMP


 к какому layer принадлежит он ? к L3 или к L4.

 к мому удивлению в интернетет нашел по этому поводу огромную кучу бесоеолдезного говна.

 техническйи ICMP инкапслиуруется внутрь IP поэтому технически он принадлжеит уровню L4 как 
 TCP\UDP. 

 но везде пишут что он принадлежит уровню L3. потому что принадлежность протокола к уровню завтсит
 нетолько с точки зрения куда он инкапуслирован и от его цели назначения.

 они пишут что L4 всегда имеет порты и предназанчен для обпеспечения обмена данными между 
 процессами на двух сервверах. и вэтом плане icmp ниразу нетакой.

 поэтому он относится к L3 уровню. в каких то постах его относят к L3.5 уровню , ровно также как 
 ARP он инкпулируебтся в L2 фрейм и технически является L3 протоколм но по своему назнаенмею он 
 не L3 пртоколк а L2 или L 2.5

 вот такая хуйня.

 далее пришое в голову вопрос --- если приложение юзает tcp\udp на одном компе два процесса и они обрашатся
 на один удаленный сервер то все понятно как ядро различает обраные пакеты - какой одному процессу подсунуть
 а какой другому. а как это есть для ICMP у котрого в его формает загловкеа нет никаких портов.

 ответ -у ICMP есть поле в загогловке называется Identifieer ( 2 байта длинной)  и оно используется ядром
 для того чтобы поимать какому процессу отоноится ответный пакет который прилетел из сети.
 работает это так --- процесс на компе шлет пинг. ядро всталвяет в пинг в поле Identifier номер этого процесса
 и шлет наружу. когда в ответ прилетает icmp reply то там содержистя тот же самый номер прцесса таким макаром
 ядро понимает что этот пакет надо сунуть обратно процессу стакимто номером.!!!! таким макаром это поле identifer 
 как бы служит номермо порта отправителя по аналгии с TCP.

 и вообще это какйото блядский прикол. протколвы уровня 3 они предназначены для связи между серверами в целом.
 а не для связи между приложениями. связь межд приложенияеми обеспечивает L4 протокол. его порты дают идентифицкаию приложения на нащем компе и на удаленом. таки макмром по мне даже для ICMP должен исползоваться
 TCP протооколв. потому что мы же пингуем с компа с какогото приложения. да мы на то компе несвязывается 
 ни с каким конкретным приложегием. но на ншаем то компе мы инциириуем с кокннретного процесса. 
 поэтмоу хуяно кончно это все как он сделано.


 класный пост котоырй обясняется по поводу ICMP и его поля identifeier =  https://hechao.li/2018/09/27/How-Is-Ping-Deduplexed/

 ==
 