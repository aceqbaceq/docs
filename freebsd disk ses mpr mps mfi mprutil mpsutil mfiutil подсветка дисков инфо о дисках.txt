| ses
| freebsd
| лампочка
| led
| sgpio
| подсветка
| диски
| disk
| hdd
| ssd
| sas2ircu
| sas3ircu
| mfi
| mpr
| mps
| locate
| mfiutil
| mprutil
| mpsutil




есть такая тема как подсветка дисков в серверах и полках.
в серверах по сути тоже внутри установлена полка enclosure

так вот подсветка лампочек на полке работает через 2 механизма.

1) ses 
    это когда полка интелекутуальная. то контроллер шлет по SAS\SATA проводу scsi команды
    на полку. и она тогда влкючает лампочку

2) SGPIO 
    это когда он контроллера идет в проводе специальная жила к энкложур. и он по ней 
    чтото передает. это вариант требует этой жилы и полка может быть более тупая.


как узнать какой вариант у нас.
на практике если у нас фрибсл то все очено просто 

   # sesutil  locatel all on

должно включить все лампочки на всех полках в том числе на морде. там где нет ses они незагорястся
(man sesutil)   


еще инфо у нас полки подклюачаься через контроллеры. а контроллеры рабтотают в ОС через драйверы
а у драйверов есть утилиты. и в них можно смотреть эту фигню.

примеры

# pciconf -l -v | grep RAID

mfi0@pci0:3:0:0:        class=0x010400 rev=0x04 hdr=0x00 vendor=0x1000 device=0x0060 subvendor=0x1028 subdevice=0x1f0c
    vendor     = 'Broadcom / LSI'
    device     = 'MegaRAID SAS 1078'
    class      = mass storage
    subclass   = RAID

mfi1@pci0:5:0:0:        class=0x010400 rev=0x05 hdr=0x00 vendor=0x1000 device=0x0079 subvendor=0x1028 subdevice=0x1f15
    vendor     = 'Broadcom / LSI'
    device     = 'MegaRAID SAS 2108 [Liberator]'
    class      = mass storage
    subclass   = RAID

mfi2@pci0:7:0:0:        class=0x010400 rev=0x05 hdr=0x00 vendor=0x1000 device=0x0079 subvendor=0x1028 subdevice=0x1f15
    vendor     = 'Broadcom / LSI'
    device     = 'MegaRAID SAS 2108 [Liberator]'
    class      = mass storage
    subclass   = RAID

здесь у нас три контроллера и их обслуживает дайрвер mfi
у  него утилита mfiutil  (man mfiutil)



значит конкретна эта утилита ничего нам не покжает про ses
но можно еще узнать через smartctl

# smartctl -a -d megaraid,0 /dev/mfi0 | grep -i transport
Transport protocol:   SAS (SPL-3)


строка транспорт!

а можено еще узнать через camcontrol 

# camcontrol devlist | grep ses                     
<DP BACKPLANE 1.07>                at scbus0 target 32 lun 0 (ses0,pass4)
<DELL MD1200 1.01>                 at scbus1 target 12 lun 0 (ses1,pass5)
<DELL MD1200 1.01>                 at scbus1 target 27 lun 0 (ses2,pass6)
<DELL MD1200 1.01>                 at scbus2 target 12 lun 0 (ses3,pass31)


вот видим ses !

опрашиывает полки через ses


# sesutil show 
ses0: <DP BACKPLANE 1.07>; ID:                0
Desc     Dev     Model                     Ident                Size/Status
-        -       -                         -                    OK
-        -       -                         -                    OK
-        -       -                         -                    OK
-        -       -                         -                    OK
-        -       -                         -                    OK
-        -       -                         -                    OK

ses1: <DELL MD1200 1.01>; ID: 500c04f28b2e6c00
Desc     Dev     Model                     Ident                Size/Status
-        pass27  ?                         ?                    OK
-        pass26  ?                         ?                    OK
-        pass30  ?                         ?                    OK
-        pass21  ?                         ?                    OK
-        pass20  ?                         ?                    OK
-        pass19  ?                         ?                    OK
-        pass24  ?                         ?                    OK
-        pass23  ?                         ?                    OK
-        pass22  ?                         ?                    OK
-        pass25  ?                         ?                    OK
-        pass28  ?                         ?                    OK
-        pass29  ?                         ?                    OK

Temperatures: , , , 
Voltages: , , , , , 

ses2: <DELL MD1200 1.01>; ID: 500c04f22b6c7400
Desc     Dev     Model                     Ident                Size/Status
-        pass16  ?                         ?                    OK
-        pass15  ?                         ?                    OK
-        pass7   ?                         ?                    OK
-        pass10  ?                         ?                    OK
-        pass9   ?                         ?                    OK
-        pass8   ?                         ?                    OK
-        pass13  ?                         ?                    OK
-        pass12  ?                         ?                    OK
-        pass11  ?                         ?                    OK
-        pass14  ?                         ?                    OK
-        pass17  ?                         ?                    OK
-        pass18  ?                         ?                    OK

Temperatures: , , , 
Voltages: , , , , , 

ses3: <DELL MD1200 1.01>; ID: 500c04f274942f00
Desc     Dev     Model                     Ident                Size/Status
-        pass42  ?                         ?                    OK
-        pass41  ?                         ?                    OK
-        pass40  ?                         ?                    OK
-        pass39  ?                         ?                    OK
-        pass38  ?                         ?                    OK
-        pass37  ?                         ?                    OK
-        pass43  ?                         ?                    OK
-        pass36  ?                         ?                    OK
-        pass35  ?                         ?                    OK
-        pass34  ?                         ?                    OK
-        pass33  ?                         ?                    OK
-        pass32  ?                         ?                    OK



видно ими полешел нахер. 
сес команды шлет драйвер mfi
так как карта работает в режиме RAID поэтом мы в данном случае нихера невидим.
поэтому в данном сулчае надо юзать фирменные утилиты MegaCli или sas2ircu\sas3ircu
типа того.


в любом случае утилита mfiutil умеет много полезного !
ксатии вот у нее есть команда нам нужная

    # mfiutil [-u unit] locate drive {on | off}

кстати номер контроллера подставляет в параметр -u 
выясняем адрес диска

    # mfiutil -u 1 show drives
mfi1 Physical Drives:
29 ( 1863G) ONLINE <SEAGATE ST2000NM0034 MS85 serial=Z1X13CVE> SCSI-6 E2:S2
30 ( 1863G) ONLINE <SEAGATE ST2000NM0034 MS85 serial=Z1X6HW3Y> SCSI-6 E2:S5
31 ( 1863G) ONLINE <SEAGATE ST2000NM0034 MS85 serial=Z1Y18GMQ> SCSI-6 E2:S4
32 ( 1863G) ONLINE <SEAGATE ST2000NM0034 MS85 serial=Z1X3GKV8> SCSI-6 E2:S3
33 ( 1863G) ONLINE <SEAGATE ST2000NM0034 MS85 serial=Z1X3DREB> SCSI-6 E2:S8

и подсвечиываем его 
    # mfiutil -u 1 locate E2:S8 on








СЛЕДУЩИЙ КОМП:

[root@backup-01 /]# pciconf -l -v  | grep  storage -A1 -B3
mps0@pci0:2:0:0:        class=0x010700 rev=0x05 hdr=0x00 vendor=0x1000 device=0x0087 subvendor=0x1028 subdevice=0x1f38
    vendor     = 'Broadcom / LSI'
    device     = 'SAS2308 PCI-Express Fusion-MPT SAS-2'
    class      = mass storage
    subclass   = SAS
mpr0@pci0:4:0:0:        class=0x010700 rev=0x01 hdr=0x00 vendor=0x1000 device=0x00c9 subvendor=0x1000 subdevice=0x3180
    vendor     = 'Broadcom / LSI'
    device     = 'SAS3216 PCI-Express Fusion-MPT SAS-3'
    class      = mass storage
    subclass   = SAS
--
mfi0@pci0:69:14:0:      class=0x010400 rev=0x00 hdr=0x00 vendor=0x1000 device=0x0411 subvendor=0x1000 subdevice=0x1003
    vendor     = 'Broadcom / LSI'
    device     = 'MegaRAID SAS 1068'
    class      = mass storage
    subclass   = RAID
[root@backup-01 /]# 



у него три карты и три драйвера
        mps
        mpr
        mfi



# camcontrol devlist | grep ses
<HP D2600 SAS AJ940A 0103>         at scbus1 target 24 lun 0 (ses0,pass10)
<XYRATEX 3GSAS1.0-SATAEXP 1.05>    at scbus2 target 58 lun 0 (ses1,pass16)
<XYRATEX 3GSAS1.0-SATAEXP 1.07>    at scbus2 target 93 lun 0 (ses2,pass20)
<XYRATEX 3GSAS1.0-SATAEXP 1.07>    at scbus2 target 106 lun 0 (ses3,pass21)
<XYRATEX 3GSAS1.0-SATAEXP 1.07>    at scbus2 target 109 lun 0 (ses4,pass22)


ну с mfiutil уже мы имели дело.
смотрим на mpsutil




[root@backup-01 /]# mpsutil show all
Adapter:
mps0 Adapter:
       Board Name: SAS9207-8i
   Board Assembly: 
        Chip Name: LSISAS2308
    Chip Revision: ALL
    BIOS Revision: 7.27.01.01
Firmware Revision: 20.00.07.00
  Integrated RAID: no
         SATA NCQ: ENABLED
 PCIe Width/Speed: x8 (8.0 GB/sec)
        IOC Speed: Full
      Temperature: 35 C

PhyNum  CtlrHandle  DevHandle  Disabled  Speed   Min    Max    Device
0                              N                 1.5    6.0    SAS Initiator 
1                              N                 1.5    6.0    SAS Initiator 
2                              N                 1.5    6.0    SAS Initiator 
3       0001        0009       N         6.0     1.5    6.0    SAS Initiator 
4       0002        000a       N         6.0     1.5    6.0    SAS Initiator 
5       0003        000b       N         3.0     1.5    6.0    SAS Initiator 
6       0005        000d       N         6.0     1.5    6.0    SAS Initiator 
7       0004        000c       N         3.0     1.5    6.0    SAS Initiator 

Devices:
B____T    SAS Address      Handle  Parent    Device        Speed Enc  Slot  Wdt
00   05   4433221103000000 0009    0001      SATA Target   6.0   0001 00    1
00   11   4433221104000000 000a    0002      SATA Target   6.0   0001 07    1
00   08   5000c50001bcc385 000b    0003      SAS Target    3.0   0001 06    1
00   09   5000c50001bd2e25 000c    0004      SAS Target    3.0   0001 04    1
00   10   4433221106000000 000d    0005      SATA Target   6.0   0001 05    1

Enclosures:
Slots      Logical ID     SEPHandle  EncHandle    Type
  08    5b083fe0c793ce00               0001     Direct Attached SGPIO

Expanders:
NumPhys   SAS Address     DevHandle   Parent  EncHandle  SAS Level



здесь вот видно
        Enclosures:
        Slots      Logical ID     SEPHandle  EncHandle    Type
        08    5b083fe0c793ce00               0001     Direct Attached SGPIO


тоесть полка плодключаена через SGPIO
тоесть через спец жилу на проводе.



а вот эта полка(полки) уже через SES

[root@backup-01 /]# mprutil show all
Adapter:
mpr0 Adapter:
       Board Name: SAS9305-16e
   Board Assembly: 
        Chip Name: LSISAS3216
    Chip Revision: A1
    BIOS Revision: 17.00.00.00
Firmware Revision: 15.00.00.00
  Integrated RAID: no
         SATA NCQ: ENABLED
 PCIe Width/Speed: x8 (8.0 GB/sec)
        IOC Speed: Full
      Temperature: 38 C

PhyNum  CtlrHandle  DevHandle  Disabled  Speed   Min    Max    Device
0       0001        0011       N         6.0     3.0    12     SAS Initiator 
1       0001        0011       N         6.0     3.0    12     SAS Initiator 
2       0001        0011       N         6.0     3.0    12     SAS Initiator 
3       0001        0011       N         6.0     3.0    12     SAS Initiator 
4       0001        0011       N         6.0     3.0    12     SAS Initiator 
5       0001        0011       N         6.0     3.0    12     SAS Initiator 
6       0001        0011       N         6.0     3.0    12     SAS Initiator 
7       0001        0011       N         6.0     3.0    12     SAS Initiator 
8                              N                 3.0    12     SAS Initiator 
9                              N                 3.0    12     SAS Initiator 
10                             N                 3.0    12     SAS Initiator 
11                             N                 3.0    12     SAS Initiator 
12                             N                 3.0    12     SAS Initiator 
13                             N                 3.0    12     SAS Initiator 
14                             N                 3.0    12     SAS Initiator 
15                             N                 3.0    12     SAS Initiator 

Devices:
B____T    SAS Address      Handle  Parent    Device        Speed Enc  Slot  Wdt
          5001438006cdc87d 0011    0001      SMP Target    6.0   0002 00    8
          5001438006cdc841 0012    0011      SATA Target   3.0   0002 14    1
          5000c50001be7452 0013    0011      SAS Target    3.0   0002 15    1
          5001438006cdc844 0014    0011      SATA Target   3.0   0002 17    1
          5000c50001bd2e06 0015    0011      SAS Target    3.0   0002 18    1
          5001438006cdc84b 0016    0011      SATA Target   3.0   0002 24    1
          5001438006cdc87c 0017    0011      SEP Target    6.0   0002 00    1

Enclosures:
Slots      Logical ID     SEPHandle  EncHandle    Type
  16    500062b2029b6a40               0001     Direct Attached SGPIO
  00    5001438006cdc840    0017       0002     External SES-2

Expanders:
NumPhys   SAS Address     DevHandle   Parent  EncHandle  SAS Level
  25    5001438006cdc87d    0011       0001     0002       1

     Phy  RemotePhy  DevHandle  Speed  Min   Max    Device
     00                                1.5   6.0   No Device     
     01      00        0012      3.0   1.5   6.0   SATA Target   
     02      01        0013      3.0   1.5   6.0   SAS Target    
     03                                1.5   6.0   No Device     
     04      00        0014      3.0   1.5   6.0   SATA Target   
     05      01        0015      3.0   1.5   6.0   SAS Target    
     06                                1.5   6.0   No Device     
     07                                1.5   6.0   No Device     
     08                                1.5   6.0   No Device     
     09                                1.5   6.0   No Device     
     10                                1.5   6.0   No Device     
     11      00        0016      3.0   1.5   6.0   SATA Target   
     12      06        0001      6.0   1.5   6.0   SAS Initiator 
     13      07        0001      6.0   1.5   6.0   SAS Initiator 
     14      05        0001      6.0   1.5   6.0   SAS Initiator 
     15      04        0001      6.0   1.5   6.0   SAS Initiator 
     16      02        0001      6.0   1.5   6.0   SAS Initiator 
     17      03        0001      6.0   1.5   6.0   SAS Initiator 
     18      01        0001      6.0   1.5   6.0   SAS Initiator 
     19      00        0001      6.0   1.5   6.0   SAS Initiator 
     20                                ???   ???   No Device     
     21                                ???   ???   No Device     
     22                                ???   ???   No Device     
     23                                ???   ???   No Device     
     24      24        0017      6.0   6.0   6.0   SEP Target    



хотя есть и sgpio

Enclosures:
Slots      Logical ID     SEPHandle  EncHandle    Type
  16    500062b2029b6a40               0001     Direct Attached SGPIO
  00    5001438006cdc840    0017       0002     External SES-2



тогда получаеем


[root@backup-01 /]# sesutil show
ses0: <HP D2600 SAS AJ940A 0103>; ID: 5001438006cdc840
Desc            Dev     Model                     Ident                Size/Status
-               -       -                         -                    Not Installed
-               -       -                         -                    OK
-               da5     ATA HGST HUS724020AL      PN1181P5H68YPW       2T
-               da6     SEAGATE ST373455SS        3LQ0PWDE00009736YU6B Not Installed
-               -       -                         -                    OK
-               da7     ATA HGST HUS724020AL      PN1181P5H6AEEW       2T
-               da8     SEAGATE ST373455SS        3LQ0PE4N00009736WQN2 Not Installed
-               -       -                         -                    Not Installed
-               -       -                         -                    Not Installed
-               -       -                         -                    Not Installed
-               -       -                         -                    Not Installed
-               -       -                         -                    OK

Temperatures: , , , 

ses1: <XYRATEX 3GSAS1.0-SATAEXP 1.05>; ID: 5000bb52116320ff
Desc            Dev     Model                     Ident                Size/Status
Overall Drives   -       -                         -                    OK
Disk #1         -       -                         -                    Not Installed
Disk #2         -       -                         -                    Not Installed
Disk #3         -       -                         -                    Not Installed
Disk #4         -       -                         -                    Not Installed
Disk #5         da13    ATA HGST HUS724020AL      PN1181P5H6H7LW       2T
Disk #6         da14    ATA HGST HUS724020AL      PN1181P5H6AG8W       2T
Disk #7         da11    ATA HGST HUS724020AL      PN1181P5H53B8W       2T
Disk #8         da15    ATA HGST HUS724020AL      PN1181P5H6E14W       2T
Disk #9         da12    ATA HGST HUS724020AL      PN2181P5H3Y0RX       2T
Disk #10        da16    ATA HGST HUS724020AL      PN1181P5H64RKW       2T
Disk #11        da10    ATA HGST HUS724020AL      PN1181P5H6E31W       2T
Disk #12        da17    ATA HGST HUS724020AL      PN1181P5H6ATTW       2T

Temperatures: Overall Temperature Sensors : 23 C, Temperature Sensor #1   : 20 C, Temperature Sensor #2   : 23 C
Voltages: , , 3.3 Volt Sensor : 3.31 V, 5 Volt Sensor   : 5.01 V, 12 Volt Sensor  : 12.12 V

ses2: <XYRATEX 3GSAS1.0-SATAEXP 1.07>; ID: 5000bb521215c0ff
Desc            Dev     Model                     Ident                Size/Status
Overall Drives   -       -                         -                    OK
Disk #1         -       -                         -                    Not Installed
Disk #2         -       -                         -                    Not Installed
Disk #3         -       -                         -                    Not Installed
Disk #4         -       -                         -                    Not Installed
Disk #5         -       -                         -                    Not Installed
Disk #6         -       -                         -                    Not Installed
Disk #7         -       -                         -                    Not Installed
Disk #8         -       -                         -                    Not Installed
Disk #9         -       -                         -                    Not Installed
Disk #10        -       -                         -                    Not Installed
Disk #11        -       -                         -                    Not Installed
Disk #12        -       -                         -                    Not Installed

Temperatures: Overall Temperature Sensors : 21 C, Temperature Sensor #1   : 21 C, Temperature Sensor #2   : 21 C
Voltages: , , 3.3 Volt Sensor : 3.28 V, 5 Volt Sensor   : 5.04 V, 12 Volt Sensor  : 12.06 V

ses3: <XYRATEX 3GSAS1.0-SATAEXP 1.07>; ID: 5000bb52121800ff
Desc            Dev     Model                     Ident                Size/Status
Overall Drives   -       -                         -                    OK
Disk #1         -       -                         -                    Not Installed
Disk #2         -       -                         -                    Not Installed
Disk #3         -       -                         -                    Not Installed
Disk #4         -       -                         -                    Not Installed
Disk #5         -       -                         -                    Not Installed
Disk #6         -       -                         -                    Not Installed
Disk #7         -       -                         -                    Not Installed
Disk #8         -       -                         -                    Not Installed
Disk #9         -       -                         -                    Not Installed
Disk #10        -       -                         -                    Not Installed
Disk #11        -       -                         -                    Not Installed
Disk #12        -       -                         -                    Not Installed

Temperatures: Overall Temperature Sensors : 22 C, Temperature Sensor #1   : 22 C, Temperature Sensor #2   : 22 C
Voltages: , , 3.3 Volt Sensor : 3.33 V, 5 Volt Sensor   : 5.04 V, 12 Volt Sensor  : 12.12 V

ses4: <XYRATEX 3GSAS1.0-SATAEXP 1.07>; ID: 5000bb521217f0ff
Desc            Dev     Model                     Ident                Size/Status
Overall Drives   -       -                         -                    OK
Disk #1         -       -                         -                    Not Installed
Disk #2         -       -                         -                    Not Installed
Disk #3         -       -                         -                    Not Installed
Disk #4         -       -                         -                    Not Installed
Disk #5         da18    ATA HGST HUS724020AL      PN1181P5H5TZNW       2T
Disk #6         da25    ATA HGST HUS724020AL      PN1181P5H69X8W       2T
Disk #7         da20    ATA HGST HUS724020AL      PN1181P5H6HA9W       2T
Disk #8         da23    ATA HGST HUS724020AL      PN1181P5H5SXAW       2T
Disk #9         da21    ATA HGST HUS724020AL      PN1181P5H67ZRW       2T
Disk #10        da22    ATA HGST HUS724020AL      PN1181P5H6LPJW       2T
Disk #11        da19    ATA HGST HUS724020AL      PN1181P5H69BZW       2T
Disk #12        da24    ATA HGST HUS724020AL      PN1181P5H61SPW       2T

Temperatures: Overall Temperature Sensors : 22 C, Temperature Sensor #1   : 21 C, Temperature Sensor #2   : 22 C
Voltages: , , 3.3 Volt Sensor : 3.30 V, 5 Volt Sensor   : 5.01 V, 12 Volt Sensor  : 12.12 V




вобщем sesutil/mprutil/mpsutil/mfiutil 
это просто кладезь полезной инфо.



