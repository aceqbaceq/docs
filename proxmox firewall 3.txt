| proxmox firewall
| firewall


мы говим про фарвоолл в его веб морде

в первых есть три места где включается фврйовролл.

датацентр
хост
вм


далее очень дебльный прикол.
если я активрую рубильник файрволла на урвоне вм то правила применются к вм что логично.

если я чктвирую рубильник фаурволла на уровне хоста то (внмиание!) эти рправила приментся не к вм
а самому хосту. к железке. это пиздец. к вм эти правила неимеют никкого отншения.

и рубильник файрволла на уровне  датацентра то он глаынм образом нужен для того что без него
предыдущие рубильник вобше неимеют никкой силы. еще там можно праивла задать они примнеются
и для хоста и для вм . и применются они самые первые. вот такая ебала.

по поводу самих праивил. файрволл стетвфулл. и он автоматом подразумевает установленное правивло что 
RELATED,ESTABLISHED  уже разрешены. тоесть если мы написали правило для потока котоый вошел
то для обратного потока правило вставять ненадо.
что приятно что для вм правила харнятся в текстомов виде в файле. и если для одной вм мы
создали правила то их можно легко скопровать длля другой вм. пример



# cat /etc/pve/firewall/291.fw 
[OPTIONS]

enable: 1
policy_out: DROP

[RULES]

OUT ACCEPT -p icmp -log nolog # ICMP разрешаю исход для всех nicN
IN ACCEPT -p icmp -log nolog # ICMP разрешаю входящие для всех nicN
IN ACCEPT -i net0 -source +ssh-good-nets -p tcp -dport 22 -log nolog # SSH разрешаю входящие для доверенных сетей
IN DROP -i net0 -p tcp -dport 22 -log nolog # SSH запрет всех остальных сетей
IN ACCEPT -i net0 -source +ssh-good-nets -p tcp -dport 9090 -log nolog # COCKPIT  разрешаю входящие c доверенных сетей
IN DROP -i net0 -p tcp -dport 9090 -log nolog # COCKPIT  запрет всех остальных сетей
IN DROP -i net0 -log nolog # запрет всего остального
OUT DROP -i net0 -log nolog # запрет всего остального
IN ACCEPT -i net1 -p udp -dport 67 -sport 68 -log nolog # DHCP разрешаю
IN ACCEPT -i net1 -p udp -dport 67 -sport 67 -log nolog # DHCP разрешаю
OUT DROP -i net1 -log nolog # запрет всего остального
IN DROP -i net1 -log nolog # запрет всего остального



этот файл можно легко скопрвать для 292 VM в файл 292.fw

