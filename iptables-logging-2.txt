на счет логирования в  nftables
есть вот такая таблица

	# cat /proc/net/netfilter/nf_log 
 0 NONE (nfnetlink_log)
 1 NONE (nfnetlink_log)
 2 nfnetlink_log (nf_log_ipv4,nfnetlink_log)  *
 3 nf_log_arp (nf_log_arp,nfnetlink_log)      *
 4 NONE (nfnetlink_log)
 5 nf_log_netdev (nf_log_netdev,nfnetlink_log) *
 6 NONE (nfnetlink_log)
 7 nfnetlink_log (nf_log_bridge,nfnetlink_log) *
 8 NONE (nfnetlink_log)
 9 NONE (nfnetlink_log)
10 nfnetlink_log (nf_log_ipv6,nfnetlink_log)  *


значит каждая строка в этой таблице это тип таблиц 
в nftables. дело в том что в нфтейблс есть разнцые типы 
таблиц. в таблицу суются правла которые филтруют трафик. 
так вот каждый тип таблиц используется для фильтрации РАЗНОГО
трафика. один тип таблиц для фильрования ipv6\ipv4 трафика

здесь каждая строка отвечает за  протокол 
строчка 2 отвечает за IPV4

так вот в этой строке указаны модули ядра котоыре в nftables\iptables отвечают за логирование, они различаются по 
тому КУДА они пишу логи.


пока кратко скажу что модуль

	nf_log_ipv4

отвечает за логирование в кернел журнал

а модуль

	nfnetlink_log

отвечает за логиварование в буфер ядра но не в кернел лог. 
и из этого буфера можно читать в юзер сепейс через нетлинк
сокет

так вот эта строка

 2 nfnetlink_log (nf_log_ipv4,nfnetlink_log)

она говорит для nftables какой модуль нужно ему юзать для
операции логирования для пакетов протокола IPV4 при действии log
в праивилах логиврание например вот такое праваило

	ip protocol icmp log 

тоесть логика какая - нфтейлс доходит до эттго правила 
и видит действие log . и тогда ЯКОБЫ нтфтейблс леезет в эту 
талицу и выясняет каким моудулем нужно логировать этот пакет.
а как яуже сказал модуль влияет КУДА будет логироваться запись.

так вот экеперимен покзыает что nftables плевать хотел на эту
настройку. какой бы ты модуль не указал - он все сука логирует
искчлетельно в кернел журнал!

пролждение следует....


# lsmod | grep -E "Used|nfnet"
Module                  Size  Used by
nfnetlink_log          24576  3

вот эта цифра "used by" равна 3 
если я стоплю  ulogd то эта цифра делается -1
тоесть она поукзывает нетлоко сокько друних модулей юзает
эту штуку но и числое нетлинк конектов к этому модулю чтоли


вроде бы - я проверил что касется nft вроде бы да
если у нас 

 cat /proc/net/netfilter/nf_log | grep 2
 2 nfnetlink_log (nf_log_ipv4,nfnetlink_log)

 и праивла 

 ip protocol icmp log group 1


то лог идет в NFT подситему

а если у нас
 cat /proc/net/netfilter/nf_log | grep 2
 2 nf_log_ipv4 (nf_log_ipv4,nfnetlink_log)

и праила

 ip protocol icmp log 

то лог идет в кернел лог

также ошибка 

tcpdump  -i nflog:1
permisions denied 
связана с тем что уже есть ккото процесс который создал
нетлинк сокет в этот NFT группу. типа того.


ИИ пишет
Если нужно, чтобы несколько процессов получали один и тот же поток логов, можно настроить nftables с правилом tee для копирования пакетов:

nft add rule inet my_filter input ip protocol icmp tee group 2

попоробовать.

 и еще попробвать вариантпрограммы на си которая пытается 
 подписаться на группу NF и увидеть что она получит нахуй олтлуп


