| iptables
| nftables
| monitoring


если у нас правила вбиты в nft подситему
(либо через nft либо через iptables-nft)
то можно наблюдать типа в реальном времени
срабатываеиние того или иного правила.
помимо логирования в системд есть еще 
вариант с -j TRACE 
повторю он ротает только для nft

скажем вот пример
я беру старые правила и сую их в nft
через iptables-nft преобразователь


# /usr/sbin/iptables-nft-save
# Generated by iptables-nft-save v1.8.9 (nf_tables) on Tue Jun 10 08:44:23 2025
*filter
:INPUT ACCEPT [1040:69680]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [1040:69680]

-A INPUT -p icmp -j TRACE  <<<<<<<<<<
-A INPUT -p icmp -j DROP

COMMIT

в итоге получаю

# nft list ruleset
table ip filter {
	chain INPUT {
		type filter hook input priority filter; policy accept;
		meta l4proto icmp counter packets 3 bytes 252 meta nftrace set 1
		meta l4proto icmp counter packets 3 bytes 252 drop
	}

	chain FORWARD {
		type filter hook forward priority filter; policy accept;
	}

	chain OUTPUT {
		type filter hook output priority filter; policy accept;
	}
}



так вот теперь можем мониторить

# xtables-monitor --trace

запукскаю ping

$ ping -c1 172.16.100.32
PING 172.16.100.32 (172.16.100.32) 56(84) bytes of data.


и наблюдаю

# xtables-monitor --trace


PACKET: 2 b3562284 IN=enp0s3 MACSRC=ae:49:9d:6e:b5:e4 MACDST=ba:ec:24:0:11:11 MACPROTO=0800 SRC=172.16.100.1 DST=172.16.100.32 LEN=84 TOS=0x0 TTL=64 ID=21031 DF 
 TRACE: 2 b3562284 filter:INPUT:rule:0x4:CONTINUE  -4 -t filter -A INPUT -p icmp -j TRACE
 TRACE: 2 b3562284 filter:INPUT:rule:0x5:DROP  -4 -t filter -A INPUT -p icmp -j DROP

 
