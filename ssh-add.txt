| ssh-add
| ssh


если мы запускаем ssh  тоесть конектится на дуаленный хост 
и при этом смортим  стрейс то мы увидим помимо конкета на удаленный тцп сервис

connect(3, {sa_family=AF_INET, sin_port=htons(22), sin_addr=inet_addr("172.16.10.11")}, 16) = 0

мы еще увидим что процесс ssh конекится через локальный именованный юникс сокет
к процесу ssh-agent в котором хранится расшированный приватнйы ключ

connect(4, {sa_family=AF_UNIX, sun_path="/home/noroot/.ssh/ssh-agent.lenovo.sock"}, 110) = 0
connect(7, {sa_family=AF_UNIX, sun_path="/home/noroot/.ssh/ssh-agent.lenovo.sock"}, 110) = 0

и действительно у процесса ssh-agent есть локальный юникс сокет

  $ sudo lsof -Pnp 2245 2>/dev/null | grep -E "FD|STREAM"
COMMAND    PID   USER  FD   TYPE             DEVICE SIZE/OFF      NODE NAME
ssh-agent 2245 noroot   3u  unix 0x00000000e8c825ff      0t0     68750 /home/noroot/.ssh/ssh-agent.lenovo.sock type=STREAM (LISTEN)
 

у меня тут же возник вопрос - как этот ssh-agent работает. он что сообщает этот ключ к
процессу ssh через этот сокет? но оказывается нет. ИИ мне сказал что  ssh-agent он не выдает
приватный ключ к ssh. вместо этого  он предосталвяет к ssh безопсный API через который ssh 
может делать аутентиифкацию.  тоесть саму аутентиацикцию делает сам ssh-agent а в ssh как я понимаю
выдается просто конечный резульат. ну или чтото типа того. условно говоря намриер ssh-agent
делает цифроую подпись испольщуя приватный ключ а в ssh передает уже цирую подпись и в этом
уже нет ничего стращного. 

поэтому два момента -  процесс ssh-agent не выдает приватный ключ ни процессу ssh ни любому другому процессу который пдключиися через этот сокет. что очень хорошо.

но не очень опнятно как ssh-aget хранит этот ключ в своей памяти. поэтому если есть процесс 
c правами root то он может юзать разные техники  типа gdb, ptrace чтение из /proc/pid/mem 
памяти этого ssh-agnt проецсса  и там найти этот ключ. что хуево.  все упирается в то как 
процесс ssh-agemt хранит привтный ключ в соей памти. защищает он его както там или нет.
это непонятно. 


который покдлчюатся через сокет  