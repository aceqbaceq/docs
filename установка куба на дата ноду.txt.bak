теперь добавляем дата ноды в к8
дата ноды ставим как уже написано выше
замечу что flannel на дата ноду ставить НЕНУЖНО! (куб сам его туда накатит)
тажке замечу что интерфейс docker0 172.17.0.1\16 появляется на ноде 
при установке докера. до установки кубернетеса. это чисто докеровский
интерфейс




на дата нодах вводим 

# kubeadm join 172.16.102.31:6443 --token ho9qay.07wqqjjeuypa5i0p  --discovery-token-ca-cert-hash sha256:95e4e1db5e638587e3cee2d662e1d55ab48a04d9d2564e8e1bad6db6d6c85500


эту строчку берем из вывода после установки кубернетеса на мастер ноде.
если мы ее прохлопали то ее можно сгенерировать заново НА МАСТЕР НОДЕ

запускаем НА МАСТЕР НОДЕ

# kubeadm token generate
# kubeadm token create <generated-token> --print-join-command --ttl=0

и после это мастер нода выдаст строку вида

>kubeadm join 172.16.102.31:6443 --token s59914.k4ku8hhl6ityqpj2     --discovery-token-ca-cert-hash sha256:485f93d02e587d9286b2c3a439c59fbc7277d7181644f48099a459abeb53e22f

вот ее то и нужно запускать НА ДАТА НОДЕ!


если мы добавляем второй контро плейн то на мастере

# kubeadm init phase upload-certs --upload-certs
[upload-certs] Using certificate key:
cbec82f4e3eed8f5ac7522cfb4137baf38c1f4c2d2bd4f6b6db27714cd126fd9

тогда строка


# kubeadm join 172.16.102.100:6440 --token isinbt.lecpp3t1nenpqlt3     --discovery-token-ca-cert-hash sha256:3b2a317f993d7ebeace52eb0d72de6a489133ac6180765a9e21787f1aa29ddf8 
--control-plane --certificate-key cbec82f4e3eed8f5ac7522cfb4137baf38c1f4c2d2bd4f6b6db27714cd126fd9

далее если мы прям сразу посмотрим статус этой ноды
то будет видно что нода notready.
это потому что надо подождать минутку чтобы мастер-нода развернула  на дата ноде
под с фланнелем. вот когда фланнель будет мастером установлен на дата ноде. вот тогда
статус дата ноды станет ready. еще раз отмечу что руками разворачивать фланнель на 
дата ноде ненужно. мастер поставит это сам автоматом.




через пару минут если все окей то дата нода напишет

проверяем статус этой ноды в кластере

#
root@test-kub-01:~# kubectl get nodes
NAME          STATUS   ROLES    AGE     VERSION
test-kub-01   Ready    master   88m     v1.16.0
test-kub-02   Ready    <none>   3m35s   v1.16.0

видно что статус kub-02 = ready.

замечу еще раз что kubectl команда будет рабоать только если в $HOME на компе на котором 
мы хотим эту комаду запустить лежит config от кластера. иначе будет выдавать ошибку.

как тока мы убедились что куб увспешно завелся на 
дата ноде надо сразу еще раз проверить и докер и кубелет
на то какой они используют драйвер cgroup

# docker info | grep -i cgroup
# journalctl -u kubelet | grep -u cgroup

он должен быть systemd для обоих. если это не так
то ищи выше как это исправить.
это надо делать сразу пока мы не запустили на дата нодах контейнеры.

также сразу поймем то что при вводе дата ноды в кластер
куб ставим на дату ноду системные поды. 
посмотрим какие системыне поды куб поставил на дата ноду

# kubectl get pods --all-namespaces -o wide

kube-flannel-ds-t8md8      1/1          172.16.102.33   test-kub-03   
kube-proxy-tch8f           1/1          172.16.102.33   test-kub-03   

итого видно что куб мастер поставил на дата ноду 
сист поды фланнель и прокси.

>>>>>>>>>>>>>>>
итого одна мастер нода и два дата ноды


root@test-kub-01:~# kubectl get nodes
NAME          STATUS   ROLES    AGE     VERSION
test-kub-01   Ready    master   92m     v1.16.0
test-kub-02   Ready    <none>   6m56s   v1.16.0
test-kub-03   Ready    <none>   58s     v1.16.0

еще раз замечу что по умолчанию к8 публиукует пользовательские поды только на дата нодах и не публикует на мастер ноде (системные поды есть на всех 
нодах)
>>>>>>>>>>


