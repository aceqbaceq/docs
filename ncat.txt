ncat

повгорим про эту улититу.


тут с самого начала ряд польебок. оказывается есть nc,ncat,netcat.
по сути это утилита про одно и тоже. оказывается что nc и netcat это одно и тоже. также оказывается 
что есть netcat так нзываемый классический а есть от bsd. есть ncat от компании nmap. 
так что это одна и таже хрень только от разных пронамистов. у них есть у каждоый свои фишки. (каыждый уебок пишет 
обязательно свою релизациию того что уже давно написано)

я щас будут говорить про ncat

есть команда cat она берет файл с диска и читает его. 

netcat тоже открывает файл и читает с него. только это сетевой сокет. 

работает это так - каждый процесс в конечном итоге слепое существо сидящее в темноте.
и у него есть несколко конвейеров которые торчат к нему из темноты - это открытые файлы. 
фишка в том что процесс понятия неимеет куда эти файлы ведут на той стороне. конвейнер 
может вести в файл на диске а может вести через сеть в процесс на другом компе. процессс сидя в темноте 
не знает что является бекендм для открытого доя него файла.

а сетевой сокет это ведь выглядит как - мы  чеерез сисколл просим открыть нам сетевой сокет. 
ядро там чтото шаманит  и процессу с неба спускается конвейнер котой ведет кудато туда хер знает 
куда. и работает это так - процесс кладет байты на конвеер и нажимает кнопку. байты улетают куда то 
наружу хер знае куда процесс об этом уже не забоится. ядро берет эти байты и сует их в сеть срет иими 
через сетевую карту. далее ядро тоже уже ничего не решает.  роутыер пинают эти байты.

байты долетают до компа на той стороне. ядро того компа принимет эти байты. 
далее на том компе есть какойто процесс тоже сидящий в темноте. и у него есть конвеейр торчащий с неба
и ему в этот конвейер прилетают эти байты. это и есть сетевой сокет. 

так вот netcat он что делает. он создает юзер процесс сидящий в темноете. открывает ему несколко файлов.
часть файлов это файлы которые ведут в терминал . один файл по нему процесс полуает байты посланные в терминал.
второй файл это процесс пишет в него и они передаются обратно на терминал. и самый интеересный файл 
это сетевой сокет. тоесть байты котоыре процесс посылает в этот файл они ядром посылаются в сеть на удаленный комп.
и наоброот с удаленного компа байты которые прилетели в ядро оно их пишет в этот файл.  
для юзер проесса это аобсолбтно похер какой бенкенд сиит на том конце файла. он просто либо читает из файла
либо пишет в файл. 
и по факту это работает так - человек в терминале пишет буквы. тыкает энтер. буквы летят в юзер процесс.
он их перенапралвяет в файл котоорый ведет  в сетевой сокет. и наоборот. если что потступило в ффайл сетевой сокет
он это перекидвыает в файл который ведет на терминал.  таки макааром человек через термиал может послыать инфо на удаленный
комп и наоброот если что с удаленного компа прилетело то человек это увидит на терминале. 

вот что делает ncat( и иже с ним nc, netcat).

по сути это программа которая работат  с сетю на уровне L7. 
тоесть она с помощью ядра открывает сеетевой сокет. для нее конечно же он выглдяит просто как некий файл дескриптор.
и она туда пишет и читает. точнее позволяет принимать баыйт с терминала и совать в тот файл. и наобророт - принимать байты
с того файла и перенаправлять их на терминал. вот и весь секрет.

получается позволяет подконектится к сетевому сокету по L7. и через терминал посылать в туда байты и принимать на терминал
оттуда байты.

в той или иной степени это аналог telnet.

окей воспользуемся этим L7 сетевым инстурментом. 
подключимся к SMTP серверу

$ ncat localhost 25
220 lenovo ESMTP Exim 4.90_1 Ubuntu Tue, 12 Sep 2023 03:26:50 +0600
> EHLO localhost
250-lenovo Hello localhost [127.0.0.1]
250-SIZE 52428800
250-8BITMIME
250-PIPELINING
250-CHUNKING
250-PRDR
250 HELP
>MAIL FROM:<smith@usa.com>                                                        
250 OK
>RCPT TO:<vasya@lenovo>   
250 Accepted
>DATA
354 Enter message, ending with "." on a line by itself
>From: smith john <smith@usa.com>       
>To: vasya <vasya@lenovo>        
>Subject: testing 03:29 12 sep 2023
>
>тестовое письмо 12 сент 2023.
>время 03:29
>
>ю
>.
250 OK id=1qfoS3-0004tQ-26

( знаком > я обозначил  строки которые  вводил я . а остальное это ответ SMTP сервера)


письмо можно прочитать в 
$ cat /var/mail/vasya 
From smith@usa.com Tue Sep 12 03:29:40 2023
Return-path: <smith@usa.com>
Envelope-to: vasya@lenovo
Delivery-date: Tue, 12 Sep 2023 03:29:40 +0600
Received: from [127.0.0.1] (helo=localhost)
	by lenovo with esmtp (Exim 4.90_1)
	(envelope-from <smith@usa.com>)
	id 1qfoS3-0004tQ-26
	for vasya@lenovo; Tue, 12 Sep 2023 03:29:40 +0600
From: smith john <smith@usa.com>
To: vasya <vasya@lenovo>
Subject: testing 03:29 12 sep 2023
Message-Id: <E1qfoS3-0004tQ-26@lenovo>
Date: Tue, 12 Sep 2023 03:29:15 +0600

тестовое письмо 12 сент 2023.
время 03:29

ю

то в какую папку и файл будет положено письмо для локального юзера зависит от самой программы SMTP которая висит на 25 порту.
exim кладет в /var/mail/$USER

замечу что /var/spool/mail это симлинк на /var/mail


дальше.
что интересно.
просто так присобачиться приконектится к сокету сетеовму которго нет не получится

пример

$ ncat localhost 56578
Ncat: Connection refused.

а все потому что конект работает на протоколе TCP который подразмуевает что ядро шлет по сети пакет и в обратку должен
прилететь ответрный пакет. а если этоого нет то пошел нахер. 



