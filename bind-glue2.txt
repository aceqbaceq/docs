у нас есть  сервера они хостят зону "."
их зовут корневые сервера днс

зона состоит из записей

по поводу из чего минимально состоит зона
читай (bind-zone-минимальный_вид.txt)



прблема в том что сервер который хостит 
зону "." он часть своих записей а именно субдомен
"net." отдал на владение другому днс серверу.
а чтоб быть более точным он часть записей
из зоны "." вычленена в отдельный файл (отдльную зону)
на отдельный сервер(но сервер не обязан быть 
отдельным он может быть  и тот же самый. важно
лишь что часть записей из одной таблицы вычленена
вынесена в дуругую таблицу)

а из той второй таблицы часть записей
для субдомена "root-servers.net." вынесена
в друуюгую таблицу

например вот так 


   . (файл зоны)
   \ 
    \
     \
      com. (файл зоны)
        \
         \
          \
           vasya.com. (файл зоны)


получается что скажем запись www.vasya.com
она лежит внутри зоны vasya.com. (внутри файла)
а если бы небыло всего это вычлененеия (делегирования) он был лежал законно в файле
зоны "."

так вот в зоне "." есть
 запись 


    "."    NS	  l.root-servers.net.



она означает какое доменное имя имеет сервер
который хранит в себе файл зоны "."

доменное это хорошо но нам чтоб пошариться 
внутри этого сервера нужно ип. нам доменое имя
в целом бесполезно

но чтобы нам узнать ИП адрес сервера  l.root-servers.net. нам нужна другая запись 
которая имеет уже ДРУГОЕ ИМЯ и другой тип


l.root-servers.net.     IN     A  x.x.x.x

проблема в том что записи хрантся в том или 
ином файле(той или иной зоне) в завсиимости от
имени.

у нас преддыдущая запист

    "."    NS	  l.root-servers.net.

она имеет имя "." поэтому она хранится в файле
зоны "."

а вот эта запись 

l.root-servers.net.     IN     A  x.x.x.x

она имеет имя l.root-servers.net., 
формально эта запись ялвяется субдоменом 
от домена "." поэтому мы могли бы ожидать что 
она хранится в этом же файле. это и так и нетак.
у нас есть такое понятие как я уже сказал 
как делегирование. это означает что мы часть
записей нашей зоны выделяем в отдьеный файл
отдеьную зону.
конкретно в случае зоны "." у нее настроено 
делегивоание для субдомена ".net"
поэтому запись с именем 


l.root-servers.net.

как бы искать в этом файле типа бесполезно

у нас есть вот такая схема делегиования

  .
  \
   \
    \
     net.
      \
       \
        \
         root-servers.net.

тоесть нашу запись нужно искать аж в третьей
таблице. 

как это выглядит с поправкой на реалии. 
на компе юзера мы укызваем ип адреса какого
нибдут днс сервера. а у него вшито в файл
ип адреса корневых днс сереров потому что иначе бы
этот днс сервер просто незнал как ему найти
эти корневые днс сервера.

окей - как найти коренвой днс сервер мы 
считай  что знаем без всякого днс. они вшиты
в файл. 


также я хочу показать как устроено делегирование
на уровне файлов зон.
для этого мы в файле зоны из которой хотим отрезать
кусок мы делаем NS запись и там укзываем днс
имя срервера на котормо лежит отрезанная зона

скажем если у нас зону "."
и мы от нее хотим отрезать кусок "net."
то мы делаем вот так


зона "." :

net.			172800	IN	NS	l.gtld-servers.net.


так ну а как нам найти ип этого сервера чтобы
заглянуть в эту таблицу "net."
для этого нам нужно знать ип этого сервера
l.gtld-servers.net.

как нам узнать ип. оно хранится в доменной записи
типа А

l.gtld-servers.net.   IN  A   IP

данная доменная запись хранится очеивдно  либо 
в зоне "net." либо в отдельной подзоне "gtld-servers.net."
пока что мы даже до зоны "net." не можем добраться
потмоу что мы ип от сервера l.gtld-servers.net.
не можем узнать. получается поисковый луп.
чтобы его разорвать в зоне "."
помещается glue запись. глю записьь это обычная
запись тип-А просто по идее в этой зоне ее
недолжно быть так как ее автортивная версия
лежит в другой зоне. но мы до нее добрвться как
раз неможем из за поисковокго лупа поэтому мы 
ее размещаем в текущей зоне в порядке исключеия.
она является неавторитивной.


поэтому у нас коренвая зона выглядит вот так

зона "." :

net.			172800	IN	NS	l.gtld-servers.net.
l.gtld-servers.net.	172800	IN	A	192.41.162.30

теперь находясь в коренвой зоне (на коренвом
днс сервере ип которого мы знаем из просто тупа
файла на компе) мы знаем чему равен ип 
от серера который заведует зоной .net

мы стучимся на него чтобы узнать какой днс сервер
заведут зоной gtld-servers.net.
нам надо понять записи от этого домена они лежат
внутри зоны "net." или эти записи эктсаратикроываны
и выделены в отдельную субзону.
делаю запрос

# dig -4 @192.41.162.30  -t NS "gtld-servers.net."  +norecurse

;; AUTHORITY SECTION:
gtld-servers.net.	172800	IN	NS	av1.nstld.com.

это значит что да записи для домена gtld-servers.net.
они хранятся в отделной зоне 
на сервере av1.nstld.com.


возвращаемся на коренеовй днс. и там смотрим 
кто заведует зоной "com."

ей заведует

com.			172800	IN	NS	l.gtld-servers.net.
l.gtld-servers.net.	172800	IN	A	192.41.162.30

идем на этот сервер и узнаем
кто заведует зоной nstld.com.

;; AUTHORITY SECTION:
nstld.com.		172800	IN	NS	av1.nstld.com.

;; ADDITIONAL SECTION:
av1.nstld.com.		172800	IN	A	192.42.177.30

этой зона выделена в отдельную и лежит на сервере
av1.nstld.com. который имеет ип 192.42.177.30

есди у нас днс сервер делегиуремой зоны
есть судомен делеигуермой зоны то всегда
в этом же таблице прикрелеется его ИП тоесть
глю запись чтобы небыло проблем с его поиском

итак мы лезем на него где хранится
зона от доменов gtld-servers.net.

и заправшиваем там напрмиер вот такую запись

 dig -4 @192.42.177.30  -t A "l.gtld-servers.net."  +norecurse


 flags: qr aa;

 ;; ANSWER SECTION:
l.gtld-servers.net.	86400	IN	A	192.41.162.30


флаг АА
нам подвттверждает что этот сервер яялвется
держателем зоны домена "gtld-servers.net."


и мы получаем наконец искому запись  и в ней
ИП 

192.41.162.30


сравниваем этот ип с тем что указан как ГЛЮ
запись в зоне "." на корневом днс

# dig -4 @199.7.83.42  -t NS "com."  +norecurse

;; ADDITIONAL SECTION:
l.gtld-servers.net.	172800	IN	A	192.41.162.30

как видим одно и тоже. 
но возможность найти автортивный сервер 
для зоны gtld-servers.net. и считать эту запись
мы не смогли бы без налчиичия ГЛЮ записи 
высоко высоков файле зоны "."

