| la
| load average


если бы мы имели дырявый мешок. и мы бы в него насыпали процессы
как семена и процессы бы вываливались из мешка но не целиком
а еще и частично. то LA это такая мат функция формула
которая показала бы  сколько процессов к настоящему 
моменту (из всех тех что были насыпаны
от начала времени ) осталось в мешке. высыпаются они именно не целиком
а своими частями. как мука. поэтому LA показаывает дробное число 5.4
поэтому LA никоим образом не связано с тем "сколько процессов R\D
было на компе за последнюю 1\5\15 минут". закон высыпания процессов
из мешка он совершенно не такой что "каждый процесс который в мешок
упал вывалится из него через 1\5\15 минут". если это было бы
так то тогда да LA показывал бы число процессов в мешке которые нападали
в него за последнюю 1\5\15 минут. но говорю пиздец в том что
процессы вываливаются из мешка по соврешенно другому закону!
достал уже этот вопрос.
если R(t) меняется хрен знает как то LA нам может сказать  о том
какой был R 5 секунд назад и то там надо считать потому что надо знать какой R(now)
и только если R(t) константа то тогда на основе LA может прикидыавть какой был R(t)
на протяжении некотрого длительного времени назад. если этого нет
то вот мы ссмотрим LA=2.4 это всего навсего нам позволяет сказать что 5c назад
R(-5c) был такой то. и то его нада высчитывать! потому что 
R(-5c)=LA(now)*k1+R(now)*k2
k1 и k2 коэфициенты которые я уже не помню. 
у LA1min\5min\15min они разные!
так что это все непросто!


==

| LA
| PSI

еще момент.
скажем у нас есть нагрузка на комп. и мы дезактивировали HT.
у нас ядер стало меньше но они стало более быстрые.

как увидеть на компе по каким то цифрам что системе стало 
лечге или тяжелее в плане "недостачи" цпу мощности.

один варинат это через LA. дело в том что LA это мешок дырявый 
в который валятся зерна(процессы). и чем мощнее цпу тем одна
и таже нагрузка будет быстрее вываливать из мешка процессы
и поэтому LA будет все меньше и меньше по крайней мере для 
нагрузки которая состоит из проецессов которые имеют короткий
срок жизни. понятно что если взять 7zip процесс с одним 
тредом и поставить его сжимать на два часа. то хоть слабый 
процессор хотть сильный у нас все время будет висеть 
один тред в щедулере поэтому LA будет = 1 хоть со слабым
цпу хоть с сильным. хоть там 100 ядер.
а если у нас нагрузка это кучка стохастических короттких 
процессов. то тут уже мощный цпу дейтсивельно приведет 
к тому что LA будет меньше чем 5 минут в случае сильного
цпу вместо слабого. и LA его занчение будет показателем.

также вместо LA можно использовать PSI который atop показывает.
его занчение тоже показывает насколько нехватает цпу.
чем меньше его значение тем лучше дышит система.

кстати LA и psi покзывают все таки несколько разное. 
psi показывает сколько %времени за сэмплинг интервал
у нас были процессы которые хотели на цпу попасть но не попали.
потому что небыло свободного цпу. тоесть они былии runnable
стояли в очереди в шедулере но не RUN потому что не было 
свободного цпу. видимо для кжадого процесса  в proc
ведется статистика сколько квантов времени он немог попасть
на цпу. предвариетлно как то так. 

как я понял psi максиум может быть 100%. я взял 4цпу и запустил 
4 процесса вида
	$ cat /dev/zero > /dev/null
у меня psi показывал 0%  потому что всем процессам плюс минус
хватало всегда цпу.  апотом я довел число таких процссов до 8.
и  у меня psi стал 95%. это значит что в очереди шедулера
на каждое ядро за сэмплинг интервал все время сэмплинга есть 
процесс который хочет попасть на ядро а оно занято. 
тоеть скоре всего вычисление этого psi отталкиватся не от статистики
процессов а от статистики ядра. тоесть я думаю она считается вот как.
каждый раз когда шедулер вызывается на ядре цпу. (условно кажоые 10мс)
и шедудер сует процесс на цпу или если их нет то не сует. и смотрит
а есть ли в очереди еще процесс который бы хоел тоже щас попсть на 
цпу. если есть то шедулер ставит себе галочку. типа вот такого

  10ms   10ms  10ms  10ms  10ms  10ms  10ms  10ms  10ms  10ms
    0      x    0      x     0     0     x    x     x      x

0 - означает что после того как цпу засунул очредной процесс на 
ядро то других процессов в очереди на ядро небыло.
а x - означает что был или были

соотвесвтеннно за данный период psi=(6/10)*100 = 60%
это psi(ядра1) за период 100ms
потом берутся все psi от всех ядер. скажем

psi(ядра1) = 60%
psi(ядра2) = 30%
psi(ядра3) = 20%
psi(ядра4) = 50%

и сумарный psi = (60+30+20+50)/4 =160/4=40%

тоесть PSI(за 1 минуту)  = N% это сколько времени были процессы
которые тоже хотели попасть на цпу но им недали потому что 
все цпу были заняты. 

поэтом PSI это нечто несклоко другое чем LA

далее.
я проверил на примере chrome+youtube.
во первых хром это многотредовый процесс. во вторых юутуб
через хром жрет цпу очень даже жадно. я вклчючил видео
поставил 720dpi и подолждат 3минуты. посмотреть чему равно LA1min
и psi. потом я изменил на 360dpi поождал 3 минуты и еще 
раз посмтрет LA1min и psi. и конечно быол видно что во
втором случае (360dpi) LA упало в два раза. и psi тоже упал 
в 2 раза. поэтому psi и lA могут служить индикаторами
если их регулярно смотреть того стало ли компу лучше в плане
достаточности цпу или стало хуже.
хуже может стать либо потому что сама нугрузка возросла
либо потому что цпу ухудшился. (например я четко увидел что если 
я дезактивирую HT то LA и psi уходят в космос по крайней мере 
на просмотре ютуба через хром.)

на счет ютуба 720dpi отличатся от 480dpi на 1.5 раза.
но это как бы длинна квадрата. а площадь получается картинки 
при  этом отличается в 1.5*1.5 = 2.25 ~ 2 раза. тоесть по идее
увелчиение dpi c 480 на 720 требует в 2 раза больше цпу мощности.

в целом это надо еще осознать результаты.

скажем если я вижу за 5с PSI=30% и число ядер 4. то это 
значит что 30% времени от 5с у нас число R процессов превышало 4 штуки.
единственное что непонятно то ли их было  5 толи 125 000. тоесть 
были пики >4 то сколько там было на пике хрен знает.

тоесть PSi позволяет понять соклько ВРЕМЕНИ нагрузка превышала
число ядер в цпу. если PSI=30% и числ ядер 4. значит 
30% времени (на сэмпилинг интервале) нагрузка была >4

	PSI=30% ====> 30% времени нагрузка >4

вот что должно в голове возникать когда видишь цифру psi
вот что она покаызвает.

поэтому если зарядить два процесса 
	$ cat /dev/zero > /dev/null
на четыре ядерном цпу
то psi будет равен 0. без всяких проблем. птому что все время 
эти прцессы они попадают на цпу. и цпу в плане доступности
шедулинга всегда в налиичии. хватвает. если проецесс
это человек который приходит на остановку на которой стоят автобусы.
а автобумы это цпу свободные в момент времни. то psi
показывает сколкьо % времени люди когда приходили на остановку
то автобуса там небыло. 

а вот случай конретный.
рабоатет ютуб. тоесть нагрузка более менее равномерная

число cpu = 4

lA1min = 0.2
psi = 1%

как это трактовать?
это трактовать так что 1% времени число R процессов (ксатти 
входят ли туда D процессы незнаю) которые хотели выполнться он 
превышало 4! тоесть то число ядер которое есть в системе!
тоесть совершенно чуть чуть иногда количество воды которое
вливается в ведро оно превышает обьем ведра. другая аналогия
на остановке 4 автобуса. которе ездя до метро. и всего 1% времени
когда число людей которые подошли на остановку превышает число 
автобусов которые стоят на остановке. все сотальное время 
люди подходят и успешно сразу садятся в автобус. ( я рассатриваю
случай когда  1 автобус везет одного человека. так точнее передается
ситцаяи с цпу и тредами)
так что psi=1% это хуйня. 

lA1min = 0.2 (учитывая что характер нагрузки все таки более менее
равномерный) нам говорит о том что  в среднем нагрузка на систему 
хуйня. именно учитвая информцаию что нагрузка вцелом досаточно равеном
ерная то можно сказать что за последние 5 минут ну вот так в среднем
у нас было 0.2 процесса  каждую секунду нагрузка на систему.
понятно что процессы они квантовые и это 1 , 2 , 3 итд 
но это просто свяазано с мат фукцией LA как она высятвыатя.
и полуается что просто напросто характер нагрузки R(t) он сильно
рваный. то процессы появляются (зерна падают в ведро) то поотом
занчительное время нихрена процессы не появляются со статусом R\D
тоесть ттишина стоит. 

да уж. LA и psi это получается интегральные характеристики. а
мы пытаемся по ним восстановить диференциальные. (грубо говрря нам
дан интеграмл R(t)  и пытаться по нему восставноить форму R(t) это
пиздец это сторго говоря не возможно)

в целом на основе PSI гораздо проще понимать 
хватвает ли тредам на компе процессора. логика простая
если в каждый момент времени у нас число R тредов меньше
чем число ядер на компе то 100% очевидно и понятно что 
треды себя чуствуют отлично на компе! потому что каждый раз когда
треду нужен цпу он ему предосталвяется! и psi=0 тогда 
а вот елси у нас число тредов зашкаливает за число ядер
и это происходит постоянно то это конечно остой. это как люди 
приходтя на остановку но автобусов на всех нет. и они стоят
и ждут. поэтому скажем psi=30% означает что 30% времени у нас
процессы на компе жестко тормозили. я тока не помню за какой 
интервал psi в atop показывает статистику для PSI.
а так получается что если psi постоянно показывает скажем 10% 
даже . то это пиздец. потому что процессы на компе конкретно
не дополучают цпу. его нужно ускорять! вот как получается !
через LA чтото понять гораздо сложнее!
так что смотрим на psi видим что он ниже 10% значит все нормал!
тредам ОС  хватвает цпу. а значит и наш юзер экспириенс будет
совершенно приятным!

| LA

как можно себе представить физ смысла числа LA
пусть  у нас есть  большая емкость с водой и дыркой внизу.
мы льем в бочку воду. по какому то закону R(t)
и а LA показывает какой поток воды вылиывается из бочки прям щас.
конечно потко воды который вылиываетя прям щас зависит от того солько воды
в бочке и сколько воды вливается прям щас. 
но это сложная зависимость. если например дырка большая то если мы будем 
вливать воду равномерно то поток на выходе будет неравномерный потокму что
чтобы поток на выходе неменялся надо вливать ровно столько воды чтобы уровень в баке
оставался константа. насколько я помню LA как раз показывает сколько воды надо 
влить в бак прям щас чтобы уровень воды внутри оставался постояннымэ
а значит и выходной поток стал постоянным тоесть LA стал постоянным.
тоеть если LA=6 значит надо чтобы в следущий момент было влито 6 литров\процессов
в систему тогда LA зафиксируется и будет равно 6 все время. 
пскольку LA квантифифицируется 5 секундными интервалами то LA=6 показыает что
если мы щас насыпем в систему 6 R процессов то LA через следущие 5с будет снова равен 6.
таков физ смысла LA! он говорит о том сколько воды\процессов надо насыпать щас чтобы 
через 5с у  нас был такой же LA! и тут нет никакой статистики по поводу а что 
там было за последнюю минуту и прочей хуйни
какая же это солжня хрень постоянно все это забываю

насколько я помню из бумажных записей если последние 5 минут нагрузка была
строго равномерной то тогда LA1min станет равна ей. тоесть если LA1min=N 
и мы точно значем что последние 5 минут R(t) неменялся был постоянным то
мы можем утрвежджать что R(за последние 5 минут ) = Const= N
вот такая связь. но это ЧАСТНЫЙ СЛУЧАЙ!
тоесть я смоьрю вижу что LA1min=0.48
тогда если я точно значю что R за последние 5 минут был константа 
то тогда я зная LA1min я могу сказать чему равно R . оно равно LA1min тоесть 0.48
только опять же прикол. R если он коснтанта он может быть равен только 1,2,3, итд
поэтому совершенно понятно что R не был константа посоедние 5 минут. 
вобщем LA это та еще мозгоебка потому что она всуунута в ядро соверешенно ни к селу
ник городу. она не подходиит для той задачи в которую ее сунули. дебиьы


| LA

еще раз я хочу пройтись по тому какой смысл несет LA=N
что эта цифра нам рактически сообщает?

скажу что для процссов на компе эта функцуия абослдтно не применина.
и поэжтму очень трудно с помошью нее типа "найти среднее число процессов"
за какоето время. она для этоговобще не предназначена.


чисто математически мы имеем картину такую у нас есть мешок дырявый 
и в него мы каждый R(t) где t дискретное мы заливаем некую новую порцию 
зерен (или воды в бутылку). а LA=N показывает сколько зерен или воды
сейчас высыпалось из мешка. LA(t0) покзавает солкьо зеерен сейчас вывалилось
из мешка. а R(t0)  покзывает сколко новых зерен мы добавили в систему
сразу после того как LA(t0) зерен вывалислось из мешка.
соотсвтетнно с прооцссами ничего тагго не компе не происходит и близко.
далее. LA(t0) он нам только повзоляет узнать какой был R(t0-5s)
при условии что это надо еще посчитать , будет использовано LA(t0)
и R(t0)
тоесть LA(t0) он не показывавет ни R(t0) ни R(t0-5s)
он вообще покзывает не ту велчиину. он не покзвыает сколько мы заливаем
в систему онпзыавет скольо вылиывается.!!
единсвтенное повторю что можно из LA(now) узнать вычислить причем это узнать 
по формуле чему был равен R(now-5s)

поскольку LA(now) покзывает сколько воды вылилось сейчас из бочки и более ничего
то странно говорить о том сколко в среднем заливали воды в каждую итерацию 
за послдение 1\5 или другой интервал времени на основе LA(NOW)
а это именно то что пытаются делать деблиы компьюерщици. они хотт узнать 
средее число процессов R\D за посоедне 1\5 мин на компе. это ровно тоже 
самое как хотеть узнать сколько в среднем воды\зерен добавляли
в бочку на каждом шаге за последние 1\5 минут.
LA(now) об этом нихрена не знает! это невозможно! оно все считает для другого
и подругому! LA(now)  незнает как заливали воду в бочку каким порциями
ни поледюю минуту. ни поледни час. она этого незнает!!!! в ней нет этой
инфоа!!! едиснвтенное что можно узнать это сколько воды задлиои в бочку R(now-5s)
и то это надо счиать. надо взять R(now) , LA(NOW)  и тогда по формлуле 
можно посчиать какой был R(now-5s). и на этмо и все!!
а чтобы поитать какой был R(t)  на все минтервале [-1min, now]
это надоо считать по формуле и нужно знать в каждой точке чему был равен LA
в этих точка. тоесть надо знать LA(t)=[-1min, now] скжаем это 12 точек 
надо знать и надо згнать R(now) тогда мы можем посчиать R(t) в кажодй точке
в тевение минуты. и найти среднее! вот какой пидец!
и только в очень частном случае так случается что среднее колиесво
вливаеомой воды на некотром интервале вреени совпдает с тем скоько воды 
выллилось прям щас ! тоеть. если мы буде вливать воду ПОСТОННОЙ струей
тоесть R(t)=CONST в течение 5 минут. то через 5 минут LA(now) станет 
равен этой CONST.  а так ккк мы все врем вливали воду с R=CONST
то среднее занечние за эти 5 минут тоже равен CONST
и вот толко в этом случае если мы смотри на комп ив идим что LA=5
мы можем судить об R(t)а точнее даже про его среднее. и мы можем скзаать что
ага раз LA(now)=5 значит срдене за посдедние 5 минут R(t) равен 5!!!!!
толко в этом частно слуучае!!! а мы когда садистя за комп мы понятия неиемеем
какой был профиль наливики воды тоеть нагрузки R(t) за посление 5 минут!!!!
поэтому если мы сели за комп. и видим что LA=3.4
то нам это гвоорит все очень мало!
если мы ПРЕДПОЛОЖИМ что нагрузка последние 5 минут неменялась а это число 
высосано из пальца! то тогда да мы можем сказать что R(t)=R_srednee=3.4
но это чисто высосано из пальца. 
что мы точно можем сказать. если мы сели и видим что LA(now)=3.4
и мы также успели както узнать чему был равен R(now) то по фрмуле мы 
можем точно посчитать чему был равен R(now-5s)
вот и все что можно высовать в плане пименнеия LA к компу и его процессам!
и чем более рваный график R(t) за последение 5 минут в релаьности 
был тем более отличается реальный R_SREDNEE за последние 5 минут 
от того что покзыает LA(now)!!!!
тоесть мы пытается определить по функции которая считаем совершенно одно
мы птыается узнать соверешно другое! это хуенна ошилка! только в супер частном
случае между этим двумя велчиинами R_SREDDEE и LA есть четкая связт!
 А ТАК В ОБЩЕМ ЕЕ НИХУЯ НЕТ!
чтобы убедиться можно запустьи мои проги
		git/docs/load-average/thinkpad-gnuplot/r_sr_za_1min.bash
		git/docs/load-average/thinkpad-gnuplot/r_sr_za_5min.bash

и можно убедиться визуально наскоько далеко LA1min(now) от R_srednee
за 5 минут.

почему я так вцеплся в эти 5 минут . потому что я почитал что 
мат формула так называемой LA1min она становится равной R_SREDNEE
при R=CONST тлоько через 5 минут!
тоесть елси у нас есть хер знает какой R(t) дерганый. мы его незанем.
а потом мы начинаем давать нагруку R(t)=Const то накоьо я щас помню
LA1min он выдет на R(t)=Const толко через 5 минту! не раньше!
LA5min выйдет не раньше чем через 15 минут!
а LA15min выдет не раньше чем через 90 минут насклоько я помню!
вот эти коэфициаонты lA1min это ничего к "среднму за 1 миунту "нихуя не имеет!
это некий коэфиицент в мат формуле насколько я помню его физ смысла 
ссостоит в том что если воду прекрартить вливать в бутылку то 
уровень воды в бутылке упадет в e~2.7 раза через 1 минуту.
в формуле LA5min урвень воды если мы закончили подоавать новую воду 
тоесть R(t)=0 стал он упадет в баке в 2.7 раза через 5 минут. а
в третье фомуле LA15min через 15 минут. тут ни ок аком нахуй срденем
количестве вливаемой воды на этих интервалах вообще речи неидет!
соотсвтенно так как количство воды вытекающее прям щас оно првооциоанльно
уровню воды в баке то и LA будет падать ровно по таому же закону.
да дело в тмо что в этой системе к которой на саоммо деле применяется
мат закон есть три участника. есть R(t) это сколько новой воды мы вливаем
в бак сейчас. есть H(t) это какой уроень воды в баке есть прямо сейчас
и есть LA(t) это сколько воды выливается из бака прям щас!
H(t)комп не считае вообще. поэтому тут такая освершенно непростая система
нипеоль. для котойй изначально и была придумана эта мат функция а ее
зсунули в комп. нахуй они это сдлали.  они прилепилилл носорогу баян
и пытатся из него узнать прогноз погдоды на марсе.

ПОЭТОМУ так как на практике никого не интересуует чему был равен R(t)
5 sec назад (ядро точки снимает R(t) кажые 5с по времени и соосвтетенно 
преесчитывает LA(t) через такие интверваалы) то ЕДИНСВТЕННОЕ
несильно практическое занчение числа LA(now) когда мы сели за компютер 
состоит в том что мы только можем вот стказать :  если за последение 5
минут на компе нагрузка была константа то я его знаю оно тогда
совпадает с LA(now)

тоесть мы сели за комп видим что LA1min)=1
значит если за последние 5 минут нащрука была CONST то она совпадатает 
с LA1min=1 тоесть типа R был равено 1.
но это чистая спекуляция! потмуо что хуй хнает какой был проиль нагрузки
на комп!

и такая же спекуляция делатеся про LA5min и LA15min
я вижу что 
	LA5min=1.16 
значит если последние 15 минут нагрузка R(t) была коната то она былав равна
1.16
я вижу что LA15min=1.09 значит елси посдение 90 минут R(t) был
коснантой то он был равен 1.09

но все равно это чисто спекулия и полная хуйня. !
дело в том что если нагрузка релаьно была костанта на этом интервале 
времнеи то LA к небудет равен дробному числу. потому что я уже сказал что
в этим случая LA=R а такк R неможет быть дробным так как комп "наливает"
воду только натуральными поорциями R=1,2,3,4,5,....
то если мы видим на компе LA1min=3.4 то это 100% значит что последние
5min нагрузка точно была рваной! поэтму пытаться узнавать R_SREDNEE
за 1\5\ или хуй знает сколько минут исользется LA занчения это 
полная профнааия и хуйня!
ну так чисто можно прикалывасть и говрит что если LA(now)=0.85
то ну типа... если нашрузка была 5 мин последних коснтанта то она
была примерн равно где то 1  . вот и все что дает нам LA(now)!!! нахрен!
про LA1min=N еще можно вот что сказать . если нагрузка на компе через 5с
будет такой же как LA сейчас то LA через 5с останется такойже. 

ИТАК если я вижу LA на компе я могу сказать три вещи.
	1) если на компе нагрузка была равномерная 5 последних минут
	то она была равна тому чему равно LA. но это только при условии равнменой
	нагрузки а какая она былаеальео хуй знает
	2) можно точно узнать каой была нагрузка -5 секунд назад.
  но ее придется по считать по формуле замопрочится
  3) если я вижу LA то я знаю какаяя должна быть нагрузка на компе 
  через +5секунд чтобы LA остался таким же неизменился.

 БОЛЬШЕ нихуя нельдя сказать про комп ничегополезного имея LA
 
