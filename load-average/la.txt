| la
| load average


если бы мы имели дырявый мешок. и мы бы в него насыпали процессы
как семена и процессы бы вываливались из мешка но не целиком
а еще и частично. то LA это такая мат функция формула
которая показала бы  сколько процессов к настоящему 
моменту (из всех тех что были насыпаны
от начала времени ) осталось в мешке. высыпаются они именно не целиком
а своими частями. как мука. поэтому LA показаывает дробное число 5.4
поэтому LA никоим образом не связано с тем "сколько процессов R\D
было на компе за последнюю 1\5\15 минут". закон высыпания процессов
из мешка он совершенно не такой что "каждый процесс который в мешок
упал вывалится из него через 1\5\15 минут". если это было бы
так то тогда да LA показывал бы число процессов в мешке которые нападали
в него за последнюю 1\5\15 минут. но говорю пиздец в том что
процессы вываливаются из мешка по соврешенно другому закону!
достал уже этот вопрос.
если R(t) меняется хрен знает как то LA нам может сказать  о том
какой был R 5 секунд назад и то там надо считать потому что надо знать какой R(now)
и только если R(t) константа то тогда на основе LA может прикидыавть какой был R(t)
на протяжении некотрого длительного времени назад. если этого нет
то вот мы ссмотрим LA=2.4 это всего навсего нам позволяет сказать что 5c назад
R(-5c) был такой то. и то его нада высчитывать! потому что 
R(-5c)=LA(now)*k1+R(now)*k2
k1 и k2 коэфициенты которые я уже не помню. 
у LA1min\5min\15min они разные!
так что это все непросто!


==

| LA
| PSI

еще момент.
скажем у нас есть нагрузка на комп. и мы дезактивировали HT.
у нас ядер стало меньше но они стало более быстрые.

как увидеть на компе по каким то цифрам что системе стало 
лечге или тяжелее в плане "недостачи" цпу мощности.

один варинат это через LA. дело в том что LA это мешок дырявый 
в который валятся зерна(процессы). и чем мощнее цпу тем одна
и таже нагрузка будет быстрее вываливать из мешка процессы
и поэтому LA будет все меньше и меньше по крайней мере для 
нагрузки которая состоит из проецессов которые имеют короткий
срок жизни. понятно что если взять 7zip процесс с одним 
тредом и поставить его сжимать на два часа. то хоть слабый 
процессор хотть сильный у нас все время будет висеть 
один тред в щедулере поэтому LA будет = 1 хоть со слабым
цпу хоть с сильным. хоть там 100 ядер.
а если у нас нагрузка это кучка стохастических короттких 
процессов. то тут уже мощный цпу дейтсивельно приведет 
к тому что LA будет меньше чем 5 минут в случае сильного
цпу вместо слабого. и LA его занчение будет показателем.

также вместо LA можно использовать PSI который atop показывает.
его занчение тоже показывает насколько нехватает цпу.
чем меньше его значение тем лучше дышит система.

кстати LA и psi покзывают все таки несколько разное. 
psi показывает сколько %времени за сэмплинг интервал
у нас были процессы которые хотели на цпу попасть но не попали.
потому что небыло свободного цпу. тоесть они былии runnable
стояли в очереди в шедулере но не RUN потому что не было 
свободного цпу. видимо для кжадого процесса  в proc
ведется статистика сколько квантов времени он немог попасть
на цпу. предвариетлно как то так. 

как я понял psi максиум может быть 100%. я взял 4цпу и запустил 
4 процесса вида
	$ cat /dev/zero > /dev/null
у меня psi показывал 0%  потому что всем процессам плюс минус
хватало всегда цпу.  апотом я довел число таких процссов до 8.
и  у меня psi стал 95%. это значит что в очереди шедулера
на каждое ядро за сэмплинг интервал все время сэмплинга есть 
процесс который хочет попасть на ядро а оно занято. 
тоеть скоре всего вычисление этого psi отталкиватся не от статистики
процессов а от статистики ядра. тоесть я думаю она считается вот как.
каждый раз когда шедулер вызывается на ядре цпу. (условно кажоые 10мс)
и шедудер сует процесс на цпу или если их нет то не сует. и смотрит
а есть ли в очереди еще процесс который бы хоел тоже щас попсть на 
цпу. если есть то шедулер ставит себе галочку. типа вот такого

  10ms   10ms  10ms  10ms  10ms  10ms  10ms  10ms  10ms  10ms
    0      x    0      x     0     0     x    x     x      x

0 - означает что после того как цпу засунул очредной процесс на 
ядро то других процессов в очереди на ядро небыло.
а x - означает что был или были

соотвесвтеннно за данный период psi=(6/10)*100 = 60%
это psi(ядра1) за период 100ms
потом берутся все psi от всех ядер. скажем

psi(ядра1) = 60%
psi(ядра2) = 30%
psi(ядра3) = 20%
psi(ядра4) = 50%

и сумарный psi = (60+30+20+50)/4 =160/4=40%

тоесть PSI(за 1 минуту)  = N% это сколько времени были процессы
которые тоже хотели попасть на цпу но им недали потому что 
все цпу были заняты. 

поэтом PSI это нечто несклоко другое чем LA

далее.
я проверил на примере chrome+youtube.
во первых хром это многотредовый процесс. во вторых юутуб
через хром жрет цпу очень даже жадно. я вклчючил видео
поставил 720dpi и подолждат 3минуты. посмотреть чему равно LA1min
и psi. потом я изменил на 360dpi поождал 3 минуты и еще 
раз посмтрет LA1min и psi. и конечно быол видно что во
втором случае (360dpi) LA упало в два раза. и psi тоже упал 
в 2 раза. поэтому psi и lA могут служить индикаторами
если их регулярно смотреть того стало ли компу лучше в плане
достаточности цпу или стало хуже.
хуже может стать либо потому что сама нугрузка возросла
либо потому что цпу ухудшился. (например я четко увидел что если 
я дезактивирую HT то LA и psi уходят в космос по крайней мере 
на просмотре ютуба через хром.)

на счет ютуба 720dpi отличатся от 480dpi на 1.5 раза.
но это как бы длинна квадрата. а площадь получается картинки 
при  этом отличается в 1.5*1.5 = 2.25 ~ 2 раза. тоесть по идее
увелчиение dpi c 480 на 720 требует в 2 раза больше цпу мощности.

в целом это надо еще осознать результаты.

скажем если я вижу за 5с PSI=30% и число ядер 4. то это 
значит что 30% времени от 5с у нас число R процессов превышало 4 штуки.
единственное что непонятно то ли их было  5 толи 125 000. тоесть 
были пики >4 то сколько там было на пике хрен знает.

тоесть PSi позволяет понять соклько ВРЕМЕНИ нагрузка превышала
число ядер в цпу. если PSI=30% и числ ядер 4. значит 
30% времени (на сэмпилинг интервале) нагрузка была >4

	PSI=30% ====> 30% времени нагрузка >4

вот что должно в голове возникать когда видишь цифру psi
вот что она покаызвает.

поэтому если зарядить два процесса 
	$ cat /dev/zero > /dev/null
на четыре ядерном цпу
то psi будет равен 0. без всяких проблем. птому что все время 
эти прцессы они попадают на цпу. и цпу в плане доступности
шедулинга всегда в налиичии. хватвает. если проецесс
это человек который приходит на остановку на которой стоят автобусы.
а автобумы это цпу свободные в момент времни. то psi
показывает сколкьо % времени люди когда приходили на остановку
то автобуса там небыло. 

а вот случай конретный.
рабоатет ютуб. тоесть нагрузка более менее равномерная

число cpu = 4

lA1min = 0.2
psi = 1%

как это трактовать?
это трактовать так что 1% времени число R процессов (ксатти 
входят ли туда D процессы незнаю) которые хотели выполнться он 
превышало 4! тоесть то число ядер которое есть в системе!
тоесть совершенно чуть чуть иногда количество воды которое
вливается в ведро оно превышает обьем ведра. другая аналогия
на остановке 4 автобуса. которе ездя до метро. и всего 1% времени
когда число людей которые подошли на остановку превышает число 
автобусов которые стоят на остановке. все сотальное время 
люди подходят и успешно сразу садятся в автобус. ( я рассатриваю
случай когда  1 автобус везет одного человека. так точнее передается
ситцаяи с цпу и тредами)
так что psi=1% это хуйня. 

lA1min = 0.2 (учитывая что характер нагрузки все таки более менее
равномерный) нам говорит о том что  в среднем нагрузка на систему 
хуйня. именно учитвая информцаию что нагрузка вцелом досаточно равеном
ерная то можно сказать что за последние 5 минут ну вот так в среднем
у нас было 0.2 процесса  каждую секунду нагрузка на систему.
понятно что процессы они квантовые и это 1 , 2 , 3 итд 
но это просто свяазано с мат фукцией LA как она высятвыатя.
и полуается что просто напросто характер нагрузки R(t) он сильно
рваный. то процессы появляются (зерна падают в ведро) то поотом
занчительное время нихрена процессы не появляются со статусом R\D
тоесть ттишина стоит. 

да уж. LA и psi это получается интегральные характеристики. а
мы пытаемся по ним восстановить диференциальные. (грубо говрря нам
дан интеграмл R(t)  и пытаться по нему восставноить форму R(t) это
пиздец это сторго говоря не возможно)

в целом на основе PSI гораздо проще понимать 
хватвает ли тредам на компе процессора. логика простая
если в каждый момент времени у нас число R тредов меньше
чем число ядер на компе то 100% очевидно и понятно что 
треды себя чуствуют отлично на компе! потому что каждый раз когда
треду нужен цпу он ему предосталвяется! и psi=0 тогда 
а вот елси у нас число тредов зашкаливает за число ядер
и это происходит постоянно то это конечно остой. это как люди 
приходтя на остановку но автобусов на всех нет. и они стоят
и ждут. поэтому скажем psi=30% означает что 30% времени у нас
процессы на компе жестко тормозили. я тока не помню за какой 
интервал psi в atop показывает статистику для PSI.
а так получается что если psi постоянно показывает скажем 10% 
даже . то это пиздец. потому что процессы на компе конкретно
не дополучают цпу. его нужно ускорять! вот как получается !
через LA чтото понять гораздо сложнее!
так что смотрим на psi видим что он ниже 10% значит все нормал!
тредам ОС  хватвает цпу. а значит и наш юзер экспириенс будет
совершенно приятным!

| LA

как можно себе представить физ смысла числа LA
пусть  у нас есть  большая емкость с водой и дыркой внизу.
мы льем в бочку воду. по какому то закону R(t)
и а LA показывает какой поток воды вылиывается из бочки прям щас.
конечно потко воды который вылиываетя прям щас зависит от того солько воды
в бочке и сколько воды вливается прям щас. 
но это сложная зависимость. если например дырка большая то если мы будем 
вливать воду равномерно то поток на выходе будет неравномерный потокму что
чтобы поток на выходе неменялся надо вливать ровно столько воды чтобы уровень в баке
оставался константа. насколько я помню LA как раз показывает сколько воды надо 
влить в бак прям щас чтобы уровень воды внутри оставался постояннымэ
а значит и выходной поток стал постоянным тоесть LA стал постоянным.
тоеть если LA=6 значит надо чтобы в следущий момент было влито 6 литров\процессов
в систему тогда LA зафиксируется и будет равно 6 все время. 
пскольку LA квантифифицируется 5 секундными интервалами то LA=6 показыает что
если мы щас насыпем в систему 6 R процессов то LA через следущие 5с будет снова равен 6.
таков физ смысла LA! он говорит о том сколько воды\процессов надо насыпать щас чтобы 
через 5с у  нас был такой же LA! и тут нет никакой статистики по поводу а что 
там было за последнюю минуту и прочей хуйни
какая же это солжня хрень постоянно все это забываю

насколько я помню из бумажных записей если последние 5 минут нагрузка была
строго равномерной то тогда LA1min станет равна ей. тоесть если LA1min=N 
и мы точно значем что последние 5 минут R(t) неменялся был постоянным то
мы можем утрвежджать что R(за последние 5 минут ) = Const= N
вот такая связь. но это ЧАСТНЫЙ СЛУЧАЙ!
тоесть я смоьрю вижу что LA1min=0.48
тогда если я точно значю что R за последние 5 минут был константа 
то тогда я зная LA1min я могу сказать чему равно R . оно равно LA1min тоесть 0.48
только опять же прикол. R если он коснтанта он может быть равен только 1,2,3, итд
поэтому совершенно понятно что R не был константа посоедние 5 минут. 
вобщем LA это та еще мозгоебка потому что она всуунута в ядро соверешенно ни к селу
ник городу. она не подходиит для той задачи в которую ее сунули. дебиьы

