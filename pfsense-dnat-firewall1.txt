| pfsense
| dnat

вопрос про связку пфсенс и днат. как оно работает.

положим WAN порт имеет IP 1.1.1.1
положим что в LAN порт имеет в  сети  IP 192.168.1.10

мы делаем DNAT правило либо NAT 1:1 где укзваываем что 1.1.1.1 -----> 192.168.1.10

спрашивается на каком файрволле  в какой секции Rule нужно пропсиыать пропускающее правило и какое?
нужно чтото писать в секции для порта WAn или порта LAN ?

сразу овтечаю что в сеции порта LAN ничего псать ТОЧНО ненужно! потому что на файрволле правиала
настраиыаются ТОЛЬКО для того случая когда пакет ВЛЕТАЕТ В ПОРТ СНАРУЖИ ЭТОГО ПОРТА! тоесть если 
мы хотим чтото писать в секции rule для порта LAn то это будет имеить силу тлоко для пакетов
которые влетают в этот порт из локалки! в нашем же случае пакет влеает в рутер в WAN порт
пролетает сковозь рутер и ВЫЛЕТАЕТ из LAn порта.  а пфсена так устроен что он нефильтрует пакеты 
на том порту из которого он ВЫЛЕТАЕТ. так что скеция LAN точно будет пустой! если он туда долетит то точно
из него вылетит автоматом!

остается секция WAN. что в ней писать? и какая в ней связь с DNAT
а работает оно вот так! ===> пакет влетает в WAN порт 

  src ip x.x.x.x   dest ip 1.1.1.1

далее он попадает в DNAT
и там он преврашается в 

  src ip x.x.x.x   dest ip 192.168.1.10


И ДАЛЕЕ ОН УЖЕ ПОПАДАЕТ В раздел фильтрации на этом поррту !! тоесть в секцию Rule на порту WAN !
и там если мы хотим этот пакет дальге пропустить то нужно вставлять вот такое правило:



  src ip x.x.x.x
  dest ip 192.168.1.10

  action : pass


вот как оно хитро!!!

