| zfs 
| snapshot

как оптравить снэпшот чреех хост посредник



===


отправитель
 #  zfs snapshot strip-2mirror/share/proxmox@2026_01_13
 # zfs list -t snapshot | grep proxmox

 #  zfs bookmark strip-2mirror/share/proxmox@2026_01_13     strip-2mirror/share/proxmox#2026_01_13
 # zfs list -t bookmark | grep proxmox


нужно указать вчерашний букмарк и сегодняшний снэпшот
 # zfs send -c -i  strip-2mirror/share/proxmox#2026_01_12    strip-2mirror/share/proxmox@2026_01_13  | mbuffer -O 100.69.78.2:9000  -m 150M


приемник
 # mbuffer -I 9000 -m 200M | zfs recv  -F   -s POOL-02/PROXMOX1-sedna_ext_ru-DATASETNAME-share_slash_proxmox


=====================================

более стары мтераиелал

отправииель
zfs send  -c strip-2mirror/share/proxmox@full_start_2026_01_10  |  mbuffer -O 100.100.0.30:8888 -r 50M -m 2G


посредник
mbuffer -I 8888 -O 100.69.78.2:9000 -m 2G


приемник

mbuffer -I 9000 -m 2G | zfs recv -s POOL-02/proxmox



sudo zfs snapshot pool/dataset@mysnap
```

### Шаг 2: Создание букмарка
Для создания букмарка используется символ `#` вместо `@`. Обычно букмарку дают то же имя, что и снимку, чтобы их было проще сопоставлять.

    # zfs bookmark pool/dataset@mysnap pool/dataset#mybookmark

### Шаг 3: Проверка
Вы можете убедиться, что букмарк создан, просмотрев список объектов соответствующего типа:
```bash
zfs list -t bookmark
```

### Для чего это нужно в 2026 году:
*   **Экономия места:** После создания букмарка вы можете удалить исходный снимок (`zfs destroy pool/dataset@mysnap`), и это освободит место на диске. При этом вы по-прежнему сможете отправить инкрементальный бэкап от этого момента времени, используя букмарк как точку отсчета.
*   **Использование при передаче:** Команда для последующей инкрементальной отправки будет выглядеть так:
    ```bash
    zfs send -i pool/dataset#mybookmark pool/dataset@new-snap | zfs recv ...
    ```

**Важное ограничение:** Из букмарка невозможно восстановить файлы напрямую или сделать `rollback`, так как он не хранит данные, а только «метку» времени.




после скачки снэпшота можно сделать его видимым 

sudo zfs set snapdir=visible имя_пула/имя_датасета

тогда в папке где примаунчен датасет ищи папку .zfs





на втором этапе нужно пклдчать букмарк и разнцу с ним


zfs send -c -i  strip-2mirror/share/proxmox#bookmark-full_start_2026_01_10    strip-2mirror/share/proxmox@2026_01_13  | mbuffer -O 100.100.0.30:8888 -r 50M -m 2G

на прмиенимке все тоже самое



