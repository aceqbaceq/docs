kubernetes
как убрать ноду из кластера \ и как эту ноду обратно rejoin к кубу

как убрать:

$ kubectl cordon имя_ноды

эта команда говоит кубу чтобы он новые поды на эту ноду не пихал

$ kubectl drain имя_ноды

эта команда типа заставляет куб поды которые крутятся на этой ноде
начать из нее убирать и запускать на других хостах

при это куб напишет что он неможет убрать с этой ноды демонсеты.

можно запустить с опцией

$ kubectl drain имя_ноды --ignore-daemonsets

оставляем на ноде куб прокси и фланнель только.

далее удаляем ноду

$ kubectl delete nodes имя_ноды

проверяем что ее нет в списке нод

$ kubectl get nodes

после этого лучше сразу пойти и удалить на дата ноде следы 
куба с нее а то если ее перезагрузить случайно она опять подконнектиться
к кубу. поэтому после удаления ее из куба лучше сраза на нее зайти и зачистить на ней остатки куба . 
(см. "удаление следов установки предыдущего кубернетеса.txt" ) 


--
бывает так что удалил ноду а оказывается ее нужно обратно вернуть.

положим мы ее только удалили и больше никаких деструктивных дейсвтий 
не сделали на ноде.

тогда чтобы ее обратно вернуть в кластер достатоно на ней самой просто
перезапустить службу kubelet

заходим на дата ноду и:

	(дата-нода)$ sudo systemctl restart kubelet

--
