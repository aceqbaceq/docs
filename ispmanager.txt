| ispmanager
| isp manager

как его поставить.
идем на сайт. там регистриуемся.
на почту придет ключ который потом 
нужно вбить в веб морду продукта.

сама установка - написано вот тут

  https://www.ispmanager.com/docs/ispmanager/ispmanager-installation-guide


в целом нужно через wget скачать скрипт.
и далее его запутить под правами root

если у нас команда

  # hostname -f

нам выдаст имя компа и оно имеет не вид домена
второго уровня как минимум то есть

  vasya.local
  vasya.local.kuku

то установщик напишет мол неверное имя домена.
как исправить - нужно пойти в 
   
   /etc/hosts

и там поправить

  172.16.10.16	ispmanager.local 

чтобы у нас hostname -f нам показал

  ispmanager.local 

тогда усанвовщик не буедет ругаться

далее когда устанощвик все установит то нужно
будет подождать минут 10-15 пока уже устанволенная
программа не сделает все послеустановочные дела.

кстати логи isp manger лежат не  в journalctl
а в папке

    /usr/local/mgr5/var

и там можно мониорить стстус ткущих дел
смотрим какие файлы часто меняются

   # find . -type f -mmin -1

и смотрим их контент


далее идем в веб морду через


   https://172.16.10.16:1500/ispmgr

там спросит логин и пароль. по дефолту нужно
ввести

   root

и пароль от входа в баш оболочку


---

далее.
панель управления работает через ihttpd службу
на порту 1500. чтобы сменить порт на 1800 скажем
то идем в 

вот так было

# cat /usr/local/mgr5/etc/ihttpd.conf | grep -v '#'

listen {
	ip 172.16.10.16
	redirect
}


вот так стало

# cat /usr/local/mgr5/etc/ihttpd.conf | grep -v '#'

listen {
	ip 172.16.10.16
        port 1800
	redirect
}


перезапускаем службу

   systemctl restart ihttpd

проверяем

# ss -tnlp | grep 1800
LISTEN 0      500     172.16.10.16:1800      0.0.0.0:*    users:(("ihttpd",pid=650,fd=5))                                    


далее.
как в isp manager доавить файрволл правило
на основе IP (это добавит в итоге праивло в 
iptables)

  Navigation board - Firewall 


далее.
у нас isp manager он ставит под себя php
в папку

   /opt

наример он там ставит две версии пхп

   /opt/php74
   /opt/php83


как посмтреть какие модули в рамках эти инсталляций
активиорваны.
для этого идем в 

  /opt/php*/bin

и запускаем 

  $ ./php -m 

и полуичим саисок модулей. важно обьязетлно
запускать в виде ./php чтобы запустился пхп
именно из этой папки. а не вот так  $ php -m
потому что в этом случае заупстся php совсм из
другой папки.

как при этом узнать версию у конкртеного модулля
а вот так

  # ./php --ri "ionCube Loader" | grep -i version
     Loader version => 14.0.0



как проверить какие модули пхп активрованы
через веб морду

 navigation board - php - 
выбираем версию пхп из списка
ставим галочку , нажимаем сверху кнопку "Extensions"
откроются модули которые доступны и которые из 
них активированы - тоесть они добавлены в конфиг
а именно на практике это значит что для данного
модуля появелся файл в папке 
  
    /opt/php74/etc/php.d

напрмиер там для модуля ioncube там появлется 
файл

   05-ioncube.ini


вот еще по теме активации модулей для пхп
https://www.ispmanager.com/docs/ispmanager/install-a-php-extension-manually



далее как проверить что  у нас есть fail2ban
и что он подключен к isp manager.
идем в 

  Software configuration - 

и ищем там в списке Fail2Ban


далее
чтобы включить порт 1501
то надо сделать вот так

    Navigation Board -  Web-server settings;
    и снять галочку с 

    Enable work with external applications through SSL.

проверить вот так

  # ss -tnlp | grep 1501

должно быть пусто



длаее как в ispamanger 
еняь настройки PHP его параметров которые
если руками менять то нужно было бы идти в 

  /opt/php74/etc/php.ini

а так идем в 


    Navigation Board -  Web-server - PHP 

выбирем в списке нужную версию PHP интерпетора
где хотим порвить . выдлеяем его галочкой.
и жмем вверху кнопку  "Extended Settings"
и там меняем например 

  sesion.gc_diviser

проверить что он имзенился можно если заглуянуь
в файл 

  $ cat  /opt/phpXX/etc/php.ini | grep session.gc_diviser



длалее  ЛОГИ

navigation panel - logs


далее а как сделть так чтобы
и панель урпавления тоже шла в инет
через SSL сертфииат.
настраивать это дело через веб морду

  naviation board - panel settings

это будет гиблое дело. 
ибо там все деьбилно сделано.
там нельзя выбрать из сертифкатов которые
мы уже создали в разделе SSL и это полный ебаный
пиздец. нельзя там и создать новый.
поэтому надо идти другим путем.

надо через SSL создать вайлкдкард сертифкат.
(через DNS запрос об этом выше) и нужно найти
этот сертификат на ФС на хосте. 
нарпимер у меня оно лежит тут

   /var/www/httpd-cert/gijmokcawzi0-ru-user 

а далее нужно его вписать в конфиг ihttpd 
руками сука

   /usr/local/mgr5/etc/ihttpd.conf


listen {
	ip XX.XX.XX.XX
        port 1800
        redirect
	certkey /var/www/httpd-cert/gijmokcawzi0-ru-user/gijmokcawzi0.ru_le2.key
	cert    /var/www/httpd-cert/gijmokcawzi0-ru-user/gijmokcawzi0.ru_le2.crt
	cacert  /var/www/httpd-cert/gijmokcawzi0-ru-user/gijmokcawzi0.ru_le2.crtca

}


перезпускаем 

  # systemctl restart ihttpd

и получаем сука щастье.
можем идти тепер в 

  naviation board - panel settings


и видеть как там все круто подтянулось.

так как мы пркирутили вайлдкард сртфикат к 
ihttpd то нам осатется на dns сервере нашего 
NS сервера добавить запись например 

   welcome.gijmokcawzi0.ru   A  XX.XX.XX.XX

и тпепрь мы можем заходить по SSL серфтикикату
котоырй подисан letsencrypt а не селфсайнд
на нашу ебаную
панель
  
  https://welcome.gijmokcawzi0.ru:1500/


далее хотел скаать что isp manager после его
установки у нас появелтся в папке /opt куча php
инсталяций так вот они там берутся из за инсталляции
пакетов

  isp-php83
  isp-php56
  isp-php74
  isp-php83

то это это обычные пакеты дебиана а isp инстллятор
просто их устаналивает.

в соттаве пакетов идут разные модули

  /opt/php83/lib/php/modules/*.so

как я понимаю если я хочу обвнить эти модули
или модуль то самое верное это попровать 
обновить сам пакет  isp-php83 тоесть

  # apt-get install isp-php83

а не руками эти *.so файлы както заменять

 