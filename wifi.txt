wifi

все началось что после очердной перезагрузки перестал работать вай фай.
и также в граф режиме на экране было написано что cinnamon неможет найти дрова поэтмоу 
работает щас без граф ускорения.

сразу краткий ответ - та версия ядра что загружена в ней нет модуля для карты от вай фай 
и нет дров от видеокарты.

длинный ответ - как понять что у данного ядра нет дров под вай фай 

$ lspci  -nn -v
02:00.0 Network controller [0280]: Qualcomm Atheros QCA9377 802.11ac Wireless Network Adapter [168c:0042] (rev 31)
	Subsystem: Lenovo QCA9377 802.11ac Wireless Network Adapter [17aa:0901]
	Flags: bus master, fast devsel, latency 0, IRQ 140
	Memory at a4000000 (64-bit, non-prefetchable) [size=2M]
	Capabilities: <access denied>
	Kernel driver in use: ath10k_pci
	Kernel modules: ath10k_pci


в этой команде мы видим что у нас есть вай фай карточка.
и что ее обслуживает драйвер\модуль  ath10k_pci

так вот если у данной модели ядра нет этого модуля то вот этих стро не будет

Kernel driver in use: ath10k_pci
Kernel modules: ath10k_pci


также небудет сетевой картчоки отвечающей за вай фай

# ip -c a

 wlp2s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 80:30:49:b2:85:cf brd ff:ff:ff:ff:ff:ff
    inet 192.168.0.41/24 brd 192.168.0.255 scope global dynamic noprefixroute wlp2s0
       valid_lft 23998sec preferred_lft 23998sec


вот эта команда тоже будет пустая

#  nmcli dev wifi list
IN-USE  SSID           MODE   CHAN  RATE        SIGNAL  BARS  SECURITY  
*       Olive2         Infra  2     270 Mbit/s  69      ▂▄▆_  WPA2      
        Olive3         Infra  3     270 Mbit/s  57      ▂▄▆_  WPA2      
        AllCALL        Infra  1     270 Mbit/s  42      ▂▄__  WPA1 WPA2 
        Mirlan         Infra  3     270 Mbit/s  40      ▂▄__  WPA2      
        Kanykei        Infra  3     270 Mbit/s  39      ▂▄__  WPA2      
        olive3000      Infra  8     270 Mbit/s  37      ▂▄__  WPA2      
        Olive3         Infra  1     270 Mbit/s  34      ▂▄__  WPA2      
        KyrgyzTourism  Infra  7     130 Mbit/s  34      ▂▄__  WPA1 WPA2 
        ZTE_vTSKwt     Infra  6     130 Mbit/s  30      ▂___  WPA1 WPA2 
        netis_13CFD0   Infra  2     270 Mbit/s  27      ▂___  WPA1 WPA2 
        TP-Link_E062   Infra  2     270 Mbit/s  25      ▂___  WPA2      
        Dastan         Infra  5     130 Mbit/s  25      ▂___  WPA1 WPA2 
        KANY           Infra  1     130 Mbit/s  22      ▂___  WPA1 WPA2 


что делать если возникла прблема.
лезем в инет с телефона и ищем как называется модуль который обсулуживает нащу вай фай карту
Qualcomm Atheros QCA9377

это модуль ath10k_pci

далее идем в /lib/modules и ищем может у нас есть какая то модель ядра  вкоторой есть 
даннйы модуль. пример

# find /lib/modules -type f -name "ath10*"
/lib/modules/5.4.0-91-generic/kernel/drivers/net/wireless/ath/ath10k/ath10k_usb.ko
/lib/modules/5.4.0-91-generic/kernel/drivers/net/wireless/ath/ath10k/ath10k_core.ko
/lib/modules/5.4.0-91-generic/kernel/drivers/net/wireless/ath/ath10k/ath10k_sdio.ko
/lib/modules/5.4.0-91-generic/kernel/drivers/net/wireless/ath/ath10k/ath10k_pci.ko


значит в ядре 5.4.0-91 есть то что надо.


далее идем в настроки grub 
и активируем чтобы при загрузке она выскочило окно grub


# cat /etc/default/grub  | grep GRUB
...
GRUB_TIMEOUT_STYLE=menu
GRUB_TIMEOUT=30


перезагружаемся.
выбираем 5.4.0-91  грузмися. проверяем помогло ли.

далее задача в том чтобы это ядро сделать дефолтовым при загрузке


как выбрать в меню другое ядро для загрузки 
из установенных

cстатья - https://support.huaweicloud.com/intl/en-us/trouble-ecs/ecs_trouble_0327.html

если коротко:
/etc/default/grub

меняем GRUB_DEFAULT=0 на GRUB_DEFAULT="1>1"

тоесть
# cat /etc/default/grub  | grep -i default
GRUB_DEFAULT="1>1"



главный вопрос как понять какую цифрц ставить
цифра означает номер меную или субмену в списке загрузки граба.

смотрим в файл
# cat grub.cfg | grep menu 

0 menuentry 'Ubuntu' --class ubuntu ...
1 submenu 'Advanced options for Ubuntu' ...
	0 menuentry 'Ubuntu, with Linux 5.4.0-117-generic' ...
	1 menuentry 'Ubuntu, with Linux 5.4.0-117-generic (recovery mode)
	2 menuentry 'Ubuntu, with Linux 5.4.0-99-generic' 
	3 menuentry 'Ubuntu, with Linux 5.4.0-99-generic (recovery mode)
	4 menuentry 'Ubuntu, with Linux 4.15.0-134-generic'
	5 menuentry 'Ubuntu, with Linux 4.15.0-134-generic (recovery mode)
	6 menuentry 'Ubuntu, with Linux 4.15.0-112-generic' 
	7 menuentry 'Ubuntu, with Linux 4.15.0-112-generic (recovery mode)
	8 menuentry 'Ubuntu, with Linux 4.15.0-96-generic' 
	9 menuentry 'Ubuntu, with Linux 4.15.0-96-generic (recovery mode)


слева я проставил цифры. которые присваивает граб менюшкам своим. возвращаемся к строке GRUB_DEFAULT="1>1"
первая цифра это цифра главного меню. а еслт у меню есть субменю то вторая цифра озанчает позицию в субменю.
щас обьясню на примерах. кстаи каойто придурок писал что позици меню которые отвечают за recovery mode они не входят в цифриы .это полная
ложь. все строки меню имеют цифры. далее примеры. какая строка как будет обозначаться в грабе , српва от строки я встаовяю сотвттсвующую 
строку для комагды с грабом:



0 menuentry 'Ubuntu' --class ubuntu ... GRUB_DEFAULT="0"
1 submenu 'Advanced options for Ubuntu' ... GRUB_DEFAULT="1"
	0 menuentry 'Ubuntu, with Linux 5.4.0-117-generic' ...  GRUB_DEFAULT="1>0"
	1 menuentry 'Ubuntu, with Linux 5.4.0-117-generic (recovery mode)  GRUB_DEFAULT="1>1"
	2 menuentry 'Ubuntu, with Linux 5.4.0-99-generic'  GRUB_DEFAULT="1>2"
	3 menuentry 'Ubuntu, with Linux 5.4.0-99-generic (recovery mode)  GRUB_DEFAULT="1>3"
	4 menuentry 'Ubuntu, with Linux 4.15.0-134-generic'  GRUB_DEFAULT="1>4"
	5 menuentry 'Ubuntu, with Linux 4.15.0-134-generic (recovery mode) GRUB_DEFAULT="1>5"
	6 menuentry 'Ubuntu, with Linux 4.15.0-112-generic'  GRUB_DEFAULT="1>6"
	7 menuentry 'Ubuntu, with Linux 4.15.0-112-generic (recovery mode) GRUB_DEFAULT="1>7"
	8 menuentry 'Ubuntu, with Linux 4.15.0-96-generic'  GRUB_DEFAULT="1>8"
	9 menuentry 'Ubuntu, with Linux 4.15.0-96-generic (recovery mode) GRUB_DEFAULT="1>9"



надюсь теперт будет понятно кака ястрока каой цифроу ширфрутся.
еще добавлю что в яндекс обрлаке ни в коем случа нельзя запускать со строкой которая с recovery - витртуалка незагрузися!!! никакого recovery !


теперь с цифрааи разобралсиь.

далее это еще неконец. нам нужно после редактирования /etc/default/grub  обновить  основной конфиг граба через команду # update-grub. 
но вдруг мы все сломаем. вдруг незагрузися в том плане что 
мы все такм могли выбрат неверрную цифру или выранное ядро херовое и мы с него не сможем загрузится. (так дальше и случилось).
поэтому можно попросить граб загрузистя один раз свсего один раз с нововыбранным ядром. если мы с новым ядром незагрузися 
то мы просто poweroff машину и грузися с осноного ядра без прбем. так чуд команда для загрузски с выбранным 
ядром один раз :

# grub-reboot "1>1"
# reboot

так вот у меня так и полусло. я выбрал верстю 96 ядра с recovery опцией. перегзупщися но не загрузилось.
poweroff.
если все окей. мы загрузились . то тогда уже меняем основгой конфиг граба.

# update-grub
# reboot

готво.
===
| wifi

как подключиться к wifi по nmcli

nmcli


# nmcli dev status
# nmcli radio wifi
# nmcli dev wifi list
# nmcli dev wifi connect SSID --ask
# nmcli conn $SSID up

кстати наткнулся на подьебку
надо юзать ключ -c
    $ ping -c 3 192.168.0.1
а если юзать ключ -n котоырй говорит что нужно при вывваоде давать только IP
и при этом еще и число то будет ругань что "DIFFERENT ADDRESS"
    $ ping -n 3 192.168.0.1 <===== так делать ненадо

    
    
    
    
    
а  вот пример. стоит одна AP за стенкой.
я пдключаюсь к ней по 2.4 и по 5
и 5 GHz имеет существенно херовей сигнал


# iwconfig wlp2s0
wlp2s0    IEEE 802.11  ESSID:"iphone4-24G"  
          Mode:Managed  Frequency:2.447 GHz  Access Point: 9C:53:22:14:D8:23   
          Bit Rate=1 Mb/s   Tx-Power=20 dBm   
          Retry short limit:7   RTS thr:off   Fragment thr:off
          Encryption key:off
          Power Management:off
          Link Quality=70/70  Signal level=-40 dBm  
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:0  Invalid misc:0   Missed beacon:0


здесь  я хочу обратить внимание на строчку
         Link Quality=70/70  Signal level=-40 dBm  
левый параметр показывает качество приема сигнала в манере "чтобы было понятно даже лоху"
тоесть 70/70. просто и понятно. а правый параметр показыает качество приема сигнала уже
в форме абсолютной физической величины тоеть для тех кто понимает в теме сигналов.



# iw dev
phy#0
	Unnamed/non-netdev interface
		wdev 0x13
		addr 80:30:49:b2:85:cf
		type P2P-device
		txpower 0.00 dBm
	Interface wlp2s0
		ifindex 3
		wdev 0x1
		addr 80:30:49:b2:85:cf
		ssid iphone4-24G
		type managed
		channel 8 (2447 MHz), width: 40 MHz, center1: 2437 MHz
		txpower 20.00 dBm

		
тоесть мы видим что     частота 2.447 GHz (канал 8),   bit rate (можно посрать что тут написано)
Link Quality=70/70  Signal level=-40 dBm (согласно таблице выше это отличный сигнал).
кстати я хочу сказать в чем разница между Tx-Power=20 dBm и  Signal level=-40 dBm ==>
как я понял Tx-Power=20 dBm это тупо с какой мощностью шарашит точка в нашу сторону своим излучателем.
а Signal level=-40 dBm это уже  и есть самая важная для нас характерситика это качество сигнала
которое до нас долетает (видимо уровень искажений). в целом эти две характиеристкии связаны. 
но в конечном итоге нам важен высокий Signal lebel в конечном итоге. на Tx-Power влияет то что когда
мы на точке выставляем мощностт излучения (  слабо, средне, мощно). но в конечном итоге надо 
смотреть на Signal level
Далее. ширина канала 40MHz = она влияет на то что если канал шире то срупут больше за единицу 
времени но если вокруг куча других точек которые юзают этот же канал то мы будем мешать друг 
другу. если хочется более надежной связи то надо выставлять на AP 20MHz.
также я прочел что 40MHz она налезает на соседние каналы.

я даже нееочень понимаю как можно работаь на ширине 20MHZ потому что вот значения центральнойй
частоты каналов

            * 2412 MHz [1] (20.0 dBm)
			* 2417 MHz [2] (20.0 dBm)
			* 2422 MHz [3] (20.0 dBm)
			* 2427 MHz [4] (20.0 dBm)
			* 2432 MHz [5] (20.0 dBm)
			* 2437 MHz [6] (20.0 dBm)
			* 2442 MHz [7] (20.0 dBm)
			* 2447 MHz [8] (20.0 dBm)
			* 2452 MHz [9] (20.0 dBm)
			* 2457 MHz [10] (20.0 dBm)
			* 2462 MHz [11] (20.0 dBm)
			* 2467 MHz [12] (20.0 dBm) (no IR)
			* 2472 MHz [13] (20.0 dBm) (no IR)
			* 2484 MHz [14] (disabled)

как видно между ними нет зазора даже в 20Mhz . !!!

вот можно посмтртеь на кких каналах сидят соседи

# nmcli dev wifi list
IN-USE  SSID          MODE   CHAN  RATE        SIGNAL  BARS  SECURITY  
*       iphone4-24G   Infra  8     130 Mbit/s  100     ▂▄▆█  WPA2      
*       iphone4-24G   Infra  8     130 Mbit/s  80      ▂▄▆_  WPA2      
        T             Infra  2     270 Mbit/s  65      ▂▄▆_  WPA1 WPA2 
        B             Infra  11    130 Mbit/s  45      ▂▄__  WPA1 WPA2 
        B             Infra  1     130 Mbit/s  42      ▂▄__  WPA1 WPA2 
        L             Infra  11    135 Mbit/s  42      ▂▄__  WPA1 WPA2 
        E             Infra  1     270 Mbit/s  37      ▂▄__  WPA2      
        D             Infra  10    270 Mbit/s  34      ▂▄__  WPA2      
        k             Infra  2     270 Mbit/s  30      ▂___  WPA2      




теперь смотрим на связь по 5 GHz



# iwconfig wlp2s0
wlp2s0    IEEE 802.11  ESSID:"iphone4-50G"  
          Mode:Managed  Frequency:5.18 GHz  Access Point: 9C:53:22:14:D8:25   
          Bit Rate=6 Mb/s   Tx-Power=30 dBm   
          Retry short limit:7   RTS thr:off   Fragment thr:off
          Encryption key:off
          Power Management:off
          Link Quality=46/70  Signal level=-64 dBm  
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:0  Invalid misc:0   Missed beacon:0

        
вот ксати сигнал типа хроший но пиздец в плане ретраев и мисков
$ iwconfig wlp3s0
wlp3s0    IEEE 802.11  ESSID:"iphone4-24G"  
          Mode:Managed  Frequency:2.447 GHz  Access Point: 9C:53:22:14:D8:23   
          Bit Rate=26 Mb/s   Tx-Power=22 dBm   
          Retry short limit:7   RTS thr:off   Fragment thr:off
          Power Management:off
          Link Quality=70/70  Signal level=-39 dBm  
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:1102  Invalid misc:104898   Missed beacon:0

тоесть вот она пизда
          Tx excessive retries:1102  Invalid misc:104898   Missed beacon:0

                      /\                          /\  
                      ||                          ||
                      ||                          ||
                      \\====  это пиздец =========//
типа чо делать. перегрузил точк доступа. сменил у нее канал. 
        

# iw dev
phy#0
	Unnamed/non-netdev interface
		wdev 0x13
		addr 80:30:49:b2:85:cf
		type P2P-device
		txpower 0.00 dBm
	Interface wlp2s0
		ifindex 3
		wdev 0x1
		addr 80:30:49:b2:85:cf
		ssid iphone4-50G
		type managed
		channel 36 (5180 MHz), width: 80 MHz, center1: 5210 MHz
		txpower 30.00 dBm

		
отмечу только что канал имет ширину 80 MHz и плохое качество сигнала
  Link Quality=46/70  Signal level=-64 dBm  
        

кстати как найти все публичные wifi сети ?

    # iwlist wlp2s0 scan
мы увиим подрьные парметры всех сетей которые можно увидеть через
    # nmcli dev wifi list
    
далее возможно повтор но вот 100% комана котоаря показыает вссе частоты 
котоыре поддеридживает карточка

# iwlist wlp2s0 frequency 
wlp2s0    32 channels in total; available frequencies :
          Channel 01 : 2.412 GHz
          Channel 02 : 2.417 GHz
          Channel 03 : 2.422 GHz
          Channel 12 : 2.467 GHz
          Channel 13 : 2.472 GHz
          Channel 36 : 5.18 GHz
          Channel 40 : 5.2 GHz
          Channel 44 : 5.22 GHz
          Channel 48 : 5.24 GHz
          Channel 52 : 5.26 GHz
          Channel 56 : 5.28 GHz


согласно этой команде  карточка intel 7260 нихрена 
не поддеживает 5GHz.
и кстати да везде все пиздят что она поддеживает 5GHz. но нихуя!
только 2.4Ghz. 
но зато она на 2.4GHZ поддетивает 802.11n тоесть больше скорости
вот ссылка на spec    
    (  https://ark.intel.com/content/www/us/en/ark/products/75174/intel-wireless-n-7260.html )
так что можно успокоится. 7260 не поддеживает 5GHZ!


          
          
ксатти что обоначают стандарты

IEEE 802.11b supports only the 2.4 GHz band
IEEE 802.11g supports only the 2.4 GHz band
IEEE 802.11n supports both the 2.4 GHz and 5 GHz bands, but it isn’t required by the specification to support 5 GHz
IEEE 802.11a supports only the 5 GHz band
IEEE 802.11ac supports the 5 GHz band and provides higher throughput compared to 802.11n
IEEE 802.11ax Wi-Fi 6 supports both the 2.4 GHz and 5 GHz bands

IEEE 802.11be, dubbed Extremely High Throughput (EHT), is the next amendment of the IEEE 802.11 standard,[
 which will be designated Wi-Fi 7.[6][7][8] It will build upon 802.11ax, focusing on WLAN indoor 
 and outdoor operation with stationary and pedestrian speeds in the 2.4, 5, and 6 GHz frequency bands



кстати вот эта команда она ищет все вайвай карточки на компе и показыает крактео инфо

# iw dev
phy#0
	Unnamed/non-netdev interface
		wdev 0x13
		addr 80:30:49:b2:85:cf
		type P2P-device
		txpower 0.00 dBm
	Interface wlp2s0
		ifindex 3
		wdev 0x1
		addr 80:30:49:b2:85:cf
		ssid iphone4-24G
		type managed
		channel 8 (2447 MHz), width: 20 MHz, center1: 2447 MHz
		txpower 20.00 dBm

а вот так уже можно посмтре развернутую инфо по кокнтетной картчоке
в том числе частоты
    
    # iw phy#0 info

    

вот еще утилита которая типа пощволяет ативировать и дезактивирвоть wifi картчоки

# rfkill list
0: ideapad_wlan: Wireless LAN
	Soft blocked: no
	Hard blocked: no
1: ideapad_bluetooth: Bluetooth
	Soft blocked: yes
	Hard blocked: no
2: phy0: Wireless LAN
	Soft blocked: no
	Hard blocked: no
3: hci0: Bluetooth
	Soft blocked: yes
	Hard blocked: no

	
# rfkill event
2024-01-06 15:23:19,656288+0600: idx 0 type 1 op 0 soft 0 hard 0
2024-01-06 15:23:19,656394+0600: idx 1 type 2 op 0 soft 1 hard 0
2024-01-06 15:23:19,656411+0600: idx 2 type 1 op 0 soft 0 hard 0
2024-01-06 15:23:19,656422+0600: idx 3 type 2 op 0 soft 1 hard 0


еще пара полезных команла
    # dmesg | grep iwl
    # journalctl --since today | grep iwl
    

вот ееще полезная команда

# cat /proc/net/wireless 
Inter-| sta-|   Quality        |   Discarded packets               | Missed | WE
 face | tus | link level noise |  nwid  crypt   frag  retry   misc | beacon | 22
wlp2s0: 0000   70.  -37.  -256        0      0      0      0      0        0



кстати в iwconfig есть поле "invalid misc"
это значит (согласно man iwconfig) что "other packets lost in relation with specific
wireless operation





еще можно вот атак посмретьинфо по сет картчоку
в том числе драйвер

# lshw -c network
  *-network                 
       description: Wireless interface
       product: QCA9377 802.11ac Wireless Network Adapter
       vendor: Qualcomm Atheros
       physical id: 0
       bus info: pci@0000:02:00.0
       logical name: wlp2s0
       version: 31
       serial: 80:30:49:b2:85:cf
       width: 64 bits
       clock: 33MHz
       capabilities: pm msi pciexpress bus_master cap_list ethernet physical wireless
       configuration: broadcast=yes driver=ath10k_pci driverversion=5.4.0-91-generic firmware=WLAN.TF.2.1-00021-QCARMSWP-1 ip=192.168.0.101 latency=0 link=yes multicast=yes wireless=IEEE 802.11
       resources: irq:140 memory:a1000000-a11fffff


    



==

| NetworkManager
| wifi

как добавить новую wifi сеть

создаем файл
    # cat /etc/NetworkManager/system-connections/iphone4-24G 
    [connection]
    id=iphone4-24G                             # имя лучше как у  SSID, влияет на nmcli conn list
    uuid=f30f4402-c16e-479f-b348-24a194b9e3a6  # неважно, можно просто сгенерировать
    type=wifi
    interface-name=wlp2s0                      # имя сет карты
    permissions=

    [wifi]
    mac-address-blacklist=
    mode=infrastructure
    ssid=iphone4-24G                            # SSID имя

    [wifi-security]
    key-mgmt=wpa-psk
    psk=пароль                                  # вай фай пароль

    [ipv4]
    dns-search=
    method=auto

    [ipv6]
    addr-gen-mode=stable-privacy
    dns-search=
    method=auto

    # systemctl retstart NetworkManager
    # nmcli conn up iphone4-24G


далее есть такой прикол что если wifi сеть работает в режиме hidden 
то когда мы запросим список сетей то NetworkManager долбодятел
будет показывать две продублированные сети. как я понял когда искал ответ - решения нет
    # nmcli dev wifi list
    IN-USE  SSID          MODE   CHAN  RATE        SIGNAL  BARS  SECURITY  
    *       iphone4-24G   Infra  2     270 Mbit/s  92      ▂▄▆█  WPA2      
    *       iphone4-24G   Infra  2     270 Mbit/s  78      ▂▄▆_  WPA2      

единственное решение только в том что надо подождать пару минут
и дубли исчезнут

кстати эта  команда еще полезна тем что можно посмотреть какие сети сидят на каких каналах
если мы хотим канал задать вручную на AP



==

| wifi
| энергосбережение
| powersave

значит я имел полнейший пиздец. он состоял в том что было два ноутбука связанныех по вай фай друг с другом.
и при этом через ssh был полнейший пиздец в плане залипаний при нажатии. это был **!*!*!!*!*!*!
работать по ssh было совершенно невозможно. 
так вот дело было в том что в NetworkManager была установлена энергосбережение для вай фай карточки.
я его нахуй отключил. и ссш перестал залипать мгновенно!!!! мгновеннно!
как это сделать:
согласно вот этому
https://gist.github.com/jcberthon/ea8cfe278998968ba7c5a95344bc8b55
надо это

# cat /etc/NetworkManager/conf.d/default-wifi-powersave-on.conf 
[connection]
wifi.powersave = 3

заменить на

# cat /etc/NetworkManager/conf.d/default-wifi-powersave-on.conf 
[connection]
wifi.powersave = 2

и рестартовать сетевую службу

# systemctl restart NetworkManager

но это был не конец пиздеца. потому что оказалось что уровень приема сигнала через стенку на 5GHz
был гораздо хуевее чем на 2.4GHz. поэтому нужно было еще сменить эту хрень.
тоесть 
  5GHz
    # iwconfig
    wlp2s0    IEEE 802.11  ESSID:"vasya"  
          Mode:Managed  Frequency:5.18 GHz  Access Point: 9C:53:22:14:D8:25   
          Bit Rate=6 Mb/s   Tx-Power=30 dBm   
          Retry short limit:7   RTS thr:off   Fragment thr:off
          Encryption key:off
          Power Management:off
          Link Quality=39/70  Signal level=-71 dBm                     <=== уровень сигнала
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:0  Invalid misc:30   Missed beacon:0

    2.4GHz
    # iwconfig
    wlp2s0    IEEE 802.11  ESSID:"vasya"  
          Mode:Managed  Frequency:2.427 GHz  Access Point: 9C:53:22:14:D8:23   
          Bit Rate=1 Mb/s   Tx-Power=20 dBm   
          Retry short limit:7   RTS thr:off   Fragment thr:off
          Encryption key:off
          Power Management:off
          Link Quality=61/70  Signal level=-49 dBm                    <=== уровень сигнала
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:0  Invalid misc:11   Missed beacon:0


еще по идее можно посмотреть свойства модуля который дает драйвер 
карточки. и в нем могут быть опции котоые отвечают за энергосбережение 
на этой карточке.
например
    # lspci -k  | grep Net -A5
        03:00.0 Network controller: Intel Corporation Wireless 7260 (rev 6b)
            Subsystem: Intel Corporation Wireless-N 7260
            Kernel driver in use: iwlwifi
            Kernel modules: iwlwifi

значит имя модуля iwlwifi
теперт смотрим какие параметры имеет этот модуль
    # modinfo iwlwifi | grep parm | grep power
        parm:  power_save:enable WiFi power management (default: disable) (bool)
        parm:  power_level:default power save level (range from 1 - 5, default: 1) (int)
значит если мы будем загружать этот модуль с опцией power_save=0
то карточка будет работать без энергосбережения.
добавляем вот сюда строку
    # cat /etc/modprobe.d/iwlwifi.conf | grep -v '#'
        options   iwlwifi power_save=0
если хотим прописать несклоко опций то делаем это так
        options   iwlwifi power_save=0    11n_disable=8
выгружаем и загружаем обратно модуль
    # modprobe -rv iwlwifi
    # modprobe -v iwlwifi
смотрим применился ли параметр
    # cat /sys/module/iwlwifi/parameters/power_save 
    N
видим что параметр применился

        



| полезные команды про сеть и  вай фай в линуксе

как понять какой модуль рулит сетевой карточкой

    # lspci -v | grep Ethernet -C 10

    00:19.0 Ethernet controller: Intel Corporation Ethernet Connection I217-LM (rev 04)
	Subsystem: Lenovo ThinkPad T440p
	Flags: bus master, fast devsel, latency 0, IRQ 31
	Memory at f0500000 (32-bit, non-prefetchable) [size=128K]
	Memory at f053f000 (32-bit, non-prefetchable) [size=4K]
	I/O ports at 3080 [size=32]
	Capabilities: [c8] Power Management version 2
	Capabilities: [d0] MSI: Enable+ Count=1/1 Maskable- 64bit+
	Capabilities: [e0] PCI Advanced Features
	Kernel driver in use: e1000e
	Kernel modules: e1000e   <===== имя модуля который обеспечивает драйвер
	

убираем модуль
    # modprobe -rv e1000e
    rmmod e1000e


отключаем из автозагрузки
    # cat /etc/modprobe.d/my-blacklist.conf 
        # останавливаем проводную сетевую карточку
        blacklist e1000e
    


далее еще что интересно. вот мы выгрузили модуль из памяти. 
    # lsmod | grep e1000
        (пусто)
но и lspci и другие команды будут по прежнему показывать проводную карточку.
тоесть

    # lspci -v | grep Ethernet -C 10
    00:19.0 Ethernet controller: Intel Corporation Ethernet Connection I217-LM (rev 04)
	Subsystem: Lenovo ThinkPad T440p
	Flags: fast devsel, IRQ 20
	Memory at f0500000 (32-bit, non-prefetchable) [size=128K]
	Memory at f053f000 (32-bit, non-prefetchable) [size=4K]
	I/O ports at 3080 [size=32]
	Capabilities: [c8] Power Management version 2
	Capabilities: [d0] MSI: Enable- Count=1/1 Maskable- 64bit+
	Capabilities: [e0] PCI Advanced Features
	Kernel modules: e1000e

и

    # lshw -class network
    *-network UNCLAIMED       
       description: Ethernet controller
       product: Ethernet Connection I217-LM
       vendor: Intel Corporation
       physical id: 19
       bus info: pci@0000:00:19.0
       version: 04
       width: 32 bits
       clock: 33MHz
       capabilities: pm msi cap_list
       configuration: latency=0
       resources: memory:f0500000-f051ffff memory:f053f000-f053ffff ioport:3080(size=32)

	
тоесть эти две команды они показывают не те устройства который подключены прямо щас. нет.
они показывают вообще все железо что есть на компе. но не факт что оно подключено


| wifi
| 5 GHz
| 2.4 GHz

как узнать на какой частоте щас работает wifi карточка.
то есть на частоте 2.4GHz или 5 GHz ?

а вот как
    # iwconfig
    wlp2s0    IEEE 802.11  ESSID:"iphone4-50G"  
          Mode:Managed  Frequency:5.18 GHz  Access Point: 9C:53:22:14:D8:25     <=== 5 GHz !!!!
          Bit Rate=6 Mb/s   Tx-Power=30 dBm   
          Retry short limit:7   RTS thr:off   Fragment thr:off
          Power Management:off
          Link Quality=54/70  Signal level=-56 dBm  
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:0  Invalid misc:0   Missed beacon:0

еще пример
    # iwconfig          
    wlp2s0    IEEE 802.11  ESSID:"iphone4-24G"  
          Mode:Managed  Frequency:2.417 GHz  Access Point: 9C:53:22:14:D8:23   <=== 2.4 GHz !!!!
          Bit Rate=1 Mb/s   Tx-Power=20 dBm   
          Retry short limit:7   RTS thr:off   Fragment thr:off
          Encryption key:off
          Power Management:off
          Link Quality=66/70  Signal level=-44 dBm  
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:0  Invalid misc:38   Missed beacon:0

          
что при этом еще интересно отметить что когда мы говорим про частоту 2.4 GHz
или 5 Ghz то на самом деле (я этого не знал) --> частота на самое деле не такая. 
она зависит от так называемого канала. вокруг базовой частоты есть несколько полос (каналов)
и они другие! пример:
на thinkpad карточка которая поддерживает только частоты вокруг 2.4 GHz
     $ iwlist wlp3s0 frequency
          wlp3s0    13 channels in total; available frequencies :
          Channel 01 : 2.412 GHz
          Channel 02 : 2.417 GHz
          Channel 03 : 2.422 GHz
          Channel 04 : 2.427 GHz
          Channel 05 : 2.432 GHz
          Channel 06 : 2.437 GHz
          Channel 07 : 2.442 GHz
          Channel 08 : 2.447 GHz
          Channel 09 : 2.452 GHz
          Channel 10 : 2.457 GHz
          Channel 11 : 2.462 GHz
          Channel 12 : 2.467 GHz
          Channel 13 : 2.472 GHz
          Current Frequency:2.417 GHz (Channel 2)

причем эта команда покзаывает не просто дипазон на котором она щас раобтает. она
показывает вообще все частоты на которых карточка может раобтать
          
значит мы видим что карточка которая поддерживает 2.4 GHz
она на самом деле работает вокруг этой частоты. и в зависимости от канала (некоей полосы конкретной)
она может иметь часатоты в диапазоне 
    ( 2.412 - 2.472 ) Ghz

и что текущая частота на карточке она работает на 2.417 GHz
вот я щас тоже самое проверю через другую команду
    $ iwconfig wlp3s0  | grep Frequency
          Mode:Managed  Frequency:2.417 GHz  Access Point: 9C:53:22:14:D8:23   

    
    
а вот на леново карточка поддерживает и 2.4 GHz и 5 Ghz
и тут уже вот такой диапазон
        # iwlist frequency
          wlp2s0    32 channels in total; available frequencies :
          Channel 01 : 2.412 GHz
          Channel 02 : 2.417 GHz
          Channel 03 : 2.422 GHz
          Channel 04 : 2.427 GHz
          Channel 05 : 2.432 GHz
          Channel 06 : 2.437 GHz
          Channel 07 : 2.442 GHz
          Channel 08 : 2.447 GHz
          Channel 09 : 2.452 GHz
          Channel 10 : 2.457 GHz
          Channel 11 : 2.462 GHz
          Channel 12 : 2.467 GHz
          Channel 13 : 2.472 GHz
          Channel 36 : 5.18 GHz
          Channel 40 : 5.2 GHz
          Channel 44 : 5.22 GHz
          Channel 48 : 5.24 GHz
          Channel 52 : 5.26 GHz
          Channel 56 : 5.28 GHz
          Channel 60 : 5.3 GHz
          Channel 64 : 5.32 GHz
          Channel 100 : 5.5 GHz
          Channel 104 : 5.52 GHz
          Channel 108 : 5.54 GHz
          Channel 112 : 5.56 GHz
          Channel 116 : 5.58 GHz
          Channel 120 : 5.6 GHz
          Channel 124 : 5.62 GHz
          Channel 128 : 5.64 GHz
          Channel 132 : 5.66 GHz
          Channel 136 : 5.68 GHz
          Channel 140 : 5.7 GHz
          Current Frequency:2.417 GHz (Channel 2)

          
    # iwconfig wlp2s0  | grep Frequency
          Mode:Managed  Frequency:2.417 GHz  Access Point: 9C:53:22:14:D8:23  

          
есть и другая команда которая покажет на каких частотах может рабоать картчока

    $ iw list
    	Frequencies:
			* 2412 MHz [1] (20.0 dBm)
			* 2417 MHz [2] (20.0 dBm)
			* 2422 MHz [3] (20.0 dBm)
			* 2427 MHz [4] (20.0 dBm)
			* 2432 MHz [5] (20.0 dBm)
			* 2437 MHz [6] (20.0 dBm)
			* 2442 MHz [7] (20.0 dBm)
			* 2447 MHz [8] (20.0 dBm)
			* 2452 MHz [9] (20.0 dBm)
			* 2457 MHz [10] (20.0 dBm)
			* 2462 MHz [11] (20.0 dBm)
			* 2467 MHz [12] (20.0 dBm) (no IR)
			* 2472 MHz [13] (20.0 dBm) (no IR)
			* 2484 MHz [14] (disabled)
	Band 2:
		Frequencies:
			* 5180 MHz [36] (30.0 dBm)
			* 5200 MHz [40] (30.0 dBm) (no IR)
			* 5220 MHz [44] (30.0 dBm) (no IR)
			* 5240 MHz [48] (30.0 dBm) (no IR)
			* 5260 MHz [52] (30.0 dBm) (no IR, radar detection)
			* 5280 MHz [56] (30.0 dBm) (no IR, radar detection)
			* 5300 MHz [60] (30.0 dBm) (no IR, radar detection)
			* 5320 MHz [64] (30.0 dBm) (no IR, radar detection)
			* 5500 MHz [100] (30.0 dBm) (no IR, radar detection)
			* 5520 MHz [104] (30.0 dBm) (no IR, radar detection)
			* 5540 MHz [108] (30.0 dBm) (no IR, radar detection)
			* 5560 MHz [112] (30.0 dBm) (no IR, radar detection)
			* 5580 MHz [116] (30.0 dBm) (no IR, radar detection)
			* 5600 MHz [120] (30.0 dBm) (no IR, radar detection)
			* 5620 MHz [124] (30.0 dBm) (no IR, radar detection)
			* 5640 MHz [128] (30.0 dBm) (no IR, radar detection)
			* 5660 MHz [132] (30.0 dBm) (no IR, radar detection)
			* 5680 MHz [136] (30.0 dBm) (no IR, radar detection)
			* 5700 MHz [140] (30.0 dBm) (no IR, radar detection)
			* 5720 MHz [144] (30.0 dBm) (no IR)
			* 5745 MHz [149] (30.0 dBm) (no IR)
			* 5765 MHz [153] (30.0 dBm) (no IR)
			* 5785 MHz [157] (30.0 dBm) (no IR)
			* 5805 MHz [161] (30.0 dBm) (no IR)
			* 5825 MHz [165] (30.0 dBm) (no IR)
			* 5845 MHz [169] (30.0 dBm) (no IR)
			* 5865 MHz [173] (disabled)


тоже самое показывет
    # iw  phy
    
не понял в чем разнциа

так что если в выоде нет 5GHz значит карта их не поддерживает


а эта комнада показывает как щас подключена карта к AP

$ iw dev
phy#0
	Unnamed/non-netdev interface
		wdev 0x13
		addr 80:30:49:b2:85:cf
		type P2P-device
		txpower 0.00 dBm
	Interface wlp2s0
		ifindex 3
		wdev 0x1
		addr 80:30:49:b2:85:cf
		ssid iphone4-50G
		type managed
		channel 36 (5180 MHz), width: 80 MHz, center1: 5210 MHz
		txpower 30.00 dBm

		
мощность вай фай сигнала меряетя в милли или микродецибелах прчем со знаком минус.
так какой сигнал можно считать хорошим?

-30 dBm = Excellent.
-67 dBm = Very Good
-70 dBm = Okay .
-80 dBm = Not Good .
-90 dBm = Unusable 


			

а вот так можно помотреть силу сигнала и есть ли ошибки

$ iwconfig wlp2s0
wlp2s0    IEEE 802.11  ESSID:"iphone4-24G"  
          Mode:Managed  Frequency:2.452 GHz  Access Point: 9C:53:22:14:D8:23   
          Bit Rate=1 Mb/s   Tx-Power=20 dBm   
          Retry short limit:7   RTS thr:off   Fragment thr:off
          Power Management:off
          Link Quality=69/70  Signal level=-41 dBm  
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:0  Invalid misc:0   Missed beacon:0

          
          
$ iwconfig wlp2s0
wlp2s0    IEEE 802.11  ESSID:"iphone4-50G"  
          Mode:Managed  Frequency:5.18 GHz  Access Point: 9C:53:22:14:D8:25   
          Bit Rate=6 Mb/s   Tx-Power=30 dBm   
          Retry short limit:7   RTS thr:off   Fragment thr:off
          Power Management:off
          Link Quality=48/70  Signal level=-62 dBm  
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:0  Invalid misc:0   Missed beacon:0


        
логи для вайфай в убунте
    # journalctl -f -u wpa_supplicant
        CTRL-EVENT-REGDOM-CHANGE init=BEACON_HINT type=UNKNOWN
        SME: Trying to authenticate with 9c:53:22:14:d8:23 (SSID='iphone4-24G' freq=2417 MHz)
        Trying to associate with 9c:53:22:14:d8:23 (SSID='iphone4-24G' freq=2417 MHz)
        RRM: Ignoring radio measurement request: Not associated
        Associated with 9c:53:22:14:d8:23
        CTRL-EVENT-SUBNET-STATUS-UPDATE status=0
        WPA: Key negotiation completed with 9c:53:22:14:d8:23 [PTK=CCMP GTK=CCMP]
        CTRL-EVENT-CONNECTED - Connection to 9c:53:22:14:d8:23 completed [id=0 id_str=]
        CTRL-EVENT-SIGNAL-CHANGE above=1 signal=-44 noise=-112 txrate=1000
        CTRL-EVENT-SIGNAL-CHANGE above=1 signal=-39 noise=-113 txrate=1000

        
| wifi
| Archer

а вот кстати как вернуть к жизни превращенный в кирпич Archer C20 = https://superuser.com/questions/1776296/how-to-recover-bricked-archer-c20

===

| wifi 
| сеть
| полезные команды

 разбираю статью
https://askubuntu.com/questions/1397239/wi-fi-connection-keeps-disconnecting

получить инфо о сетевых карточках
$ sudo  lshw -class network
  *-network UNCLAIMED       
       description: Ethernet controller
       product: Ethernet Connection I217-LM
       vendor: Intel Corporation
       physical id: 19
       bus info: pci@0000:00:19.0
       version: 04
       width: 32 bits
       clock: 33MHz
       capabilities: pm msi cap_list
       configuration: latency=0
       resources: memory:f0500000-f051ffff memory:f053f000-f053ffff ioport:3080(size=32)
  *-network
       description: Wireless interface
       product: Wireless 7260
       vendor: Intel Corporation
       physical id: 0
       bus info: pci@0000:03:00.0
       logical name: wlp3s0
       version: 6b
       serial: 28:b2:bd:80:bd:8a
       width: 64 bits
       clock: 33MHz
       capabilities: pm msi pciexpress bus_master cap_list ethernet physical wireless
       configuration: broadcast=yes driver=iwlwifi driverversion=6.2.0-33-generic firmware=17.3216344376.0 7260-17.ucode ip=192.168.0.104 latency=0 link=yes multicast=yes wireless=IEEE 802.11
       resources: irq:33 memory:f0400000-f0401fff

       
далее. прикольная команда
    $ lspci -knn | grep Net -A3
    03:00.0 Network controller [0280]: Intel Corporation Wireless 7260 [8086:08b2] (rev 6b)
        Subsystem: Intel Corporation Wireless-N 7260 [8086:c262]
        Kernel driver in use: iwlwifi
        Kernel modules: iwlwifi

ключ -k дает то что будет показан и модуль и драйвер который рулит железкой
     -nn дает то что будет показан вендор через буквы и через цифры
прикол в том что модуль порождает драйвер. при том что имя модуля может быть одно
а имя драйвера котоырй он порождает другое. также если драйвер вмонтирован в ядро то 
драйвер будет а модуля у него не будет.

например
    00:1d.0 USB controller [0c03]: Intel Corporation 8 Series/C220 Series Chipset Family USB EHCI #1 [8086:8c26] (rev 04)
        Subsystem: Lenovo ThinkPad T440p [17aa:220e]
        Kernel driver in use: ehci-pci

        
далее. конкретно по вай фай.
        $ iwlist freq
        wlp3s0    13 channels in total; available frequencies :
          Channel 01 : 2.412 GHz
          Channel 02 : 2.417 GHz
          Channel 03 : 2.422 GHz
          Channel 04 : 2.427 GHz
          Channel 05 : 2.432 GHz
          Channel 06 : 2.437 GHz
          Channel 07 : 2.442 GHz
          Channel 08 : 2.447 GHz
          Channel 09 : 2.452 GHz
          Channel 10 : 2.457 GHz
          Channel 11 : 2.462 GHz
          Channel 12 : 2.467 GHz
          Channel 13 : 2.472 GHz
          Current Frequency:2.417 GHz (Channel 2)

        
следущая команда
она ищет все SSID 
тоесть все вай фай сети
    $ iwlist scan
                Cell 02 - Address: 9C:53:22:14:D8:23   # мак адрес точки доступа
                    Channel:2                          # через какой канал наша nic подключилась 
                    Frequency:2.417 GHz (Channel 2)    # на какой частоте мы подключились
                    Quality=69/70  Signal level=-41 dBm  # качество сигнала с точкой
                    Encryption key:on
                    ESSID:"iphone4"                      # SSID
                    Bit Rates:1 Mb/s; 2 Mb/s; 5.5 Mb/s; 11 Mb/s; 9 Mb/s
                              18 Mb/s; 36 Mb/s; 54 Mb/s
                    Bit Rates:6 Mb/s; 12 Mb/s; 24 Mb/s; 48 Mb/s 
                    Mode:Master
                    Extra:tsf=0000001534c9f25e
                    Extra: Last beacon: 10467444ms ago
                    IE: IEEE 802.11i/WPA2 Version 1
                        Group Cipher : CCMP
                        Pairwise Ciphers (1) : CCMP
                        Authentication Suites (1) : PSK


в чем прикол. скорости которые указаны это какая то хрень. потому что 
по факту скорость гораздо выше.


следущая команда
покажет нам кучку полезной информации
$ iwconfig wlp3s0
    wlp3s0    IEEE 802.11  ESSID:"iphone4-24G"  
          Mode:Managed  Frequency:2.417 GHz  Access Point: 9C:53:22:14:D8:23   
          Bit Rate=300 Mb/s   Tx-Power=22 dBm   
          Retry short limit:7   RTS thr:off   Fragment thr:off
          Power Management:off
          Link Quality=70/70  Signal level=-38 dBm  
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:1  Invalid misc:2268   Missed beacon:0


    # iwconfig wlp2s0
    wlp2s0    IEEE 802.11  ESSID:"iphone4-50G"  
          Mode:Managed  Frequency:5.18 GHz  Access Point: 9C:53:22:14:D8:25   
          Bit Rate=6 Mb/s   Tx-Power=30 dBm   
          Retry short limit:7   RTS thr:off   Fragment thr:off
          Encryption key:off
          Power Management:off
          Link Quality=47/70  Signal level=-63 dBm  
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:0  Invalid misc:430   Missed beacon:0


еще одна команда
    # inxi -Fxz | grep Network -A5
    Network:   Card-1: Qualcomm Atheros QCA9377 802.11ac Wireless Network Adapter driver: ath10k_pci bus-ID: 02:00.0
    IF: wlp2s0 state: up mac: <filter>
    Card-2: Realtek RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller port: 3000 bus-ID: 03:00.0
    IF: N/A state: N/A speed: N/A duplex: N/A mac: N/A
    Card-3: Atheros usb-ID: 001-004
    IF: null-if-id state: N/A speed: N/A duplex: N/A mac: N/A


еще одна команда
# nmcli device wifi list
IN-USE  SSID         MODE   CHAN  RATE        SIGNAL  BARS  SECURITY 
*       iphone4-50G  Infra  36    135 Mbit/s  44      ▂▄__  WPA2


на этом пиздатсрадания с вайфай не закончислиьс.
на thinkpad стоит карточка intel 7260
и у нее есть проблема. она постоянно теряет связь.
незнаю от чего это завсиит. поомему это началось с версии ядра новой.

в логах это выглядиттак
    $ journalctl 
    wpa_supplicat... CTRL-EVENT-BEACON-LOSS
    
я нашел тред где все жалуются. а решения нет.
    https://bugzilla.kernel.org/show_bug.cgi?id=203709


есть полезная команда которая покажет как часто терялся этот beacon

$ iw wlp2s0 station dump
Station 9c:53:22:14:d8:23 (on wlp2s0)
	inactive time:	8148 ms
	rx bytes:	98350
	rx packets:	685
	tx bytes:	39062
	tx packets:	147
	tx retries:	0
	tx failed:	0
	beacon loss:	13    <======== !!!
	beacon rx:	270
	rx drop misc:	0
	signal:  	-43 [-43, -73] dBm
	signal avg:	-43 [-41, -73] dBm
	beacon signal avg:	213 dBm
	tx bitrate:	1.0 MBit/s
	rx bitrate:	57.8 MBit/s MCS 5 short GI
	rx duration:	0 us
	authorized:	yes
	authenticated:	yes
	associated:	yes
	preamble:	long
	WMM/WME:	yes
	MFP:		no
	TDLS peer:	no
	DTIM period:	1
	beacon interval:300
	short slot time:yes
	connected time:	83 seconds


еще напомню полезную команду


$ iwconfig wlp2s0
wlp2s0    IEEE 802.11  ESSID:"iphone4-24G"  
          Mode:Managed  Frequency:2.452 GHz  Access Point: 9C:53:22:14:D8:23   
          Bit Rate=1 Mb/s   Tx-Power=20 dBm   
          Retry short limit:7   RTS thr:off   Fragment thr:off
          Power Management:off
          Link Quality=70/70  Signal level=-40 dBm  
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:0  Invalid misc:0   Missed beacon:0


в частаостноти она показывает что у нас с power save
и мощность сигнала
и еще частоту. 2452NHZ это 9-ый канал
кстати это
     Bit Rate=1 Mb/s 
по моему фуфло.
оно работает быстрее чем пишет.

пока что вроде помогло то что на AP поставил канал в ручную 9-ый
и увеличил beacon с 100 до 300


| intel 7260
у него отвалваися wifi
кстати эта карта бывает single band и dual band
у меня очепвдно single band поэтому 5GHZ она не поддееживает

это проблемная крточка согласно инету на линукс.
во такие оации я поставил в свойствах модуля драйвера этой краты

    $ cat /etc/modprobe.d/iwlwifi.conf
    options iwlwifi power_save=0 11n_disable=8 disable_11ax=1 disable_11ac=1 disable_11be=1
дальше в этом файле идут и друие строки но они нам неинтересны

    
    # modprobe -rv iwlwifi
    # modprobe  -v iwlwifi
    
провермть чему равны эти оации можно через
    # cat /sys/module/iwlwifi/parameters/disable_11*
    Y
    Y
    Y

на счет парметра "11n_disable"
он может принимать значения 
    1:full  # полное отключение 802.11n тоесть скосрть станет супер низкая
    2: disable aggregated TX
    3: disable aggregated RX
    8: enable aggregated TX
    
говорят над с этим параметром играться елси 7260 регуларно теряет конект.
aggregated значит что как я понял пакеты собраются в кучу и передаются большими пачками. вроед так.
TX это когдмы мы шлем на точку
RX это когда мы читаем сточки

когдатеряется связь то в логах journaclt пишт что BEACON-LOST типа того.
посмотреть как часто он был потерян чможно через 

    # iw wlp2s0 station dump | grep -i beacon
либо 
    #  iwconfig wlp2s0| grep -i beacon
    
ввобще чтобы посмтреть статистику по вай фай карте надо юзать эти две команды
но без grrep

кстати посмотреть некую ифномцию про железку напрмиер ее VEN DEV можно через
        ## lspci | grep At
        02:00.0 Network controller: Qualcomm Atheros QCA9377 802.11ac Wireless Network Adapter (rev 31)

        # lspci -vv -nn  -s 02:00.0
        02:00.0 Network controller [0280]: Qualcomm Atheros QCA9377 802.11ac Wireless \
        Network Adapter [168c:0042] (rev 31)

так вот у меня intel 7260 имеет ven=8086 dev=08b2
но мало того! оказывает там чуть ниже еще есть парамтры subsystem
там написано susystem:  [8086:c262]
тоесть чтобы тточно опреедлить модеьлль железки нужно знать нетолко VEN DEV но и susystem
и я пользуясь этим нашел таки свою модель вот здесь
    https://www.devicekb.com/en/hardware/lookup
и там есть такая строка
    PCI\VEN_8086&DEV_08B2&SUBSYS_C2628086           Wireless-N 7260
    
фишка в том что если бы  это  быал dual band картчока то это бы присутвовало в ее мени
так что моя карта 1000%% single band! тоесть 2.4 GHZ only!

это также видно по тем частотм котоыре она поддеживает
    # iw phy
    

а вот еще интераная команда. применил ее на atheros


# iw  reg get
global
country 00: DFS-UNSET
	(2402 - 2472 @ 40), (6, 20), (N/A)
	(2457 - 2482 @ 20), (6, 20), (N/A), AUTO-BW, PASSIVE-SCAN
	(2474 - 2494 @ 20), (6, 20), (N/A), NO-OFDM, PASSIVE-SCAN
	(5170 - 5250 @ 80), (6, 20), (N/A), AUTO-BW, PASSIVE-SCAN
	(5250 - 5330 @ 80), (6, 20), (0 ms), DFS, AUTO-BW, PASSIVE-SCAN
	(5490 - 5730 @ 160), (6, 20), (0 ms), DFS, PASSIVE-SCAN
	(5735 - 5835 @ 80), (6, 20), (N/A), PASSIVE-SCAN
	(57240 - 63720 @ 2160), (N/A, 0), (N/A)


еще раз скажу наскольлко вот эти две комнды полезные

# iw wlp2s0 station dump
Station 9c:53:22:14:d8:23 (on wlp2s0)
	inactive time:	188 ms
	rx bytes:	33552946
	rx packets:	68717
	tx bytes:	7503141
	tx packets:	22283
	tx retries:	0
	tx failed:	0
	beacon loss:	13
	beacon rx:	17048
	rx drop misc:	0
	signal:  	-43 [-43, -73] dBm
	signal avg:	-43 [-41, -73] dBm
	beacon signal avg:	212 dBm
	tx bitrate:	1.0 MBit/s
	rx bitrate:	72.2 MBit/s MCS 7 short GI
	rx duration:	0 us
	authorized:	yes
	authenticated:	yes
	associated:	yes
	preamble:	long
	WMM/WME:	yes
	MFP:		no
	TDLS peer:	no
	DTIM period:	1
	beacon interval:300
	short slot time:yes
	connected time:	5250 seconds


	# iwconfig wlp2s0
    wlp2s0    IEEE 802.11  ESSID:"iphone4-24G"  
          Mode:Managed  Frequency:2.447 GHz  Access Point: 9C:53:22:14:D8:23   
          Bit Rate=1 Mb/s   Tx-Power=20 dBm   
          Retry short limit:7   RTS thr:off   Fragment thr:off
          Encryption key:off
          Power Management:off
          Link Quality=63/70  Signal level=-47 dBm  
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:0  Invalid misc:0   Missed beacon:0


    
