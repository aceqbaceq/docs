| zfs
| prikol
| zamena
| replace
| error


пока что стоолкнулся вот с кким приколлом.


есть пул.
в нем есть миррор.

в мирроре стали сыпаться ошибки на одном диске. я посмтрел смартцтл и да - диск в помопйку.
а еще и на другом диске зфс тоже  нарисовал пару ошибок. 

в пуле есть хотспейр.

я сдела вот так


 zpoool replace POOL_NAME  херовый_диск   спейр_диск


резвилвер закончися. но на спейр диске тоже зфс нарисовал пару ошибок. хотя отстат и смартцтл показают ок.
я пытаюсь вытащить плохой диск


 zpool detach  POOL_NAME херовый_диск
 zpool remove  POOL_NAME херовый_диск


и он мне пишет 

cannot detach c0t5000C50035F4E9ECd0: no valid replicas

и я не понял толи потому что я заменяо диск из спейр. толи потому что и на спейр диске тоже 
ошибки в итоге вылезли.

я попробвал на тестовой системе. ей похуй как я диск заменял. толи просто на основе диска который
не входит в пул. то ли из диска который входит в спейр.
я смог спококйно деаттачить плохой_диск

если мы делаем replace на базе диск который даже не входит в пул то картинка резивлеринга будет вынглядет ьвот так

       mirror-15                  ONLINE       0     0     0
            replacing-0              ONLINE       0     0     0
              c0t5000C50066FB5A29d0  ONLINE       0     0     0  (resilvering)
              c0t5000CCA24ED10AE6d0  ONLINE       0     0     0  (resilvering)
       c0t5000C50035F4E9ECd0  ONLINE       0     0     0



типа такого тоесть два диска которые входят в replacing-0 это как раз плохой и ему на замену.
а трейти это типа который непробеллемный.

а если я делабю replace на базе диска который входит в спейр то картинка резиверинга будет такая


        mirror-15                    ONLINE       6     0     4
            c0t5000C50066FB5A29d0      ONLINE       0     0    12  (resilvering)
            spare-1                    ONLINE       6     0     5
              replacing-0              ONLINE       0     0     0
                c0t5000C50035F4E9ECd0  ONLINE       6     0     5
                c0t5000CCA24ED0BB5Ed0  ONLINE       0     0     0  (resilvering)

        spares
          c0t5000CCA24ED0BB5Ed0        INUSE     currently in use


тоесть у нас лово spare-1 еще будет на экране.


в итоге я щас как сделал. я сделал детач для этого спеер диска. 
он снова стало просто спейр. я сделал еще раз детач и полностью убрал его из пула.
и потом я сделал уже replace тость 

zpool detach store  c0t5000CCA24ED0BB5Ed0
zpool detach store  c0t5000CCA24ED0BB5Ed0
 
zpool replace store   c0t5000C50035F4E9ECd0  c0t5000CCA24ED0BB5Ed0

и теперь картина вот такая



        mirror-15                    ONLINE         6     0     4
            c0t5000C50066FB5A29d0      ONLINE       0     0    12 
              replacing-0              ONLINE       0     0     0
                c0t5000C50035F4E9ECd0  ONLINE       6     0     5
                c0t5000CCA24ED0BB5Ed0  ONLINE       0     0     0  (resilvering)



